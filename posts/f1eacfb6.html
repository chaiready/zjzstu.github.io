<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="alternate" href="/./atom.xml" title="做一个幸福的人" type="application/atom+xml"><meta name="google-site-verification" content="Qr_3yqLtyErDFKHW7mE8PJz4qDUX-bf_fMLpSRckQe4"><meta name="baidu-site-verification" content="zOwIvKMV7f"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.5.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"搜索文章",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap" rel="stylesheet"><meta name="description" content="以下主要涉及颜色直方图的概念和计算最开始学习数字图像处理的时候就接触到了直方图的概念，也记录过OpenCV 1.x&#x2F;2.x的直方图实现代码"><meta name="keywords" content="c++,opencv,颜色直方图"><meta property="og:type" content="article"><meta property="og:title" content="直方图"><meta property="og:url" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;posts&#x2F;f1eacfb6.html"><meta property="og:site_name" content="做一个幸福的人"><meta property="og:description" content="以下主要涉及颜色直方图的概念和计算最开始学习数字图像处理的时候就接触到了直方图的概念，也记录过OpenCV 1.x&#x2F;2.x的直方图实现代码"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;直方图&#x2F;Histogram_Calculation_Theory_Hist0.jpg"><meta property="og:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;直方图&#x2F;Histogram_Calculation_Theory_Hist1.jpg"><meta property="og:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;直方图&#x2F;baboon.jpg"><meta property="og:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;直方图&#x2F;draw_hist.png"><meta property="og:updated_time" content="2020-02-15T05:36:35.875Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;直方图&#x2F;Histogram_Calculation_Theory_Hist0.jpg"><link rel="canonical" href="https://www.zhujian.tech/posts/f1eacfb6.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>直方图 | 做一个幸福的人</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e677aac1ac69b8826b9cfecb4e72e107";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">做一个幸福的人</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">面朝大海，春暖花开</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签<span class="badge">129</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类<span class="badge">48</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档<span class="badge">169</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header> <a href="https://github.com/zjZSTU" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zhujian.tech/posts/f1eacfb6.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="zhujian"><meta itemprop="description" content="one bite at a time"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="做一个幸福的人"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 直方图</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-11-08 09:53:16" itemprop="dateCreated datePublished" datetime="2019-11-08T09:53:16+00:00">2019-11-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-02-15 05:36:35" itemprop="dateModified" datetime="2020-02-15T05:36:35+00:00">2020-02-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/image-process/" itemprop="url" rel="index"><span itemprop="name">图像处理</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/programming-language/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/image-process/histogram/" itemprop="url" rel="index"><span itemprop="name">直方图</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/codebase/" itemprop="url" rel="index"><span itemprop="name">代码库</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>11k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>18 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p><strong>以下主要涉及颜色直方图的概念和计算</strong></p><p>最开始学习数字图像处理的时候就接触到了直方图的概念，也记录过<code>OpenCV 1.x/2.x</code>的直方图实现代码</p><a id="more"></a><ul><li><a href="https://blog.csdn.net/u012005313/article/details/51122712" target="_blank" rel="noopener">opencv 颜色直方图（灰度图，均衡化，对比，描绘颜色直方图）</a></li><li><a href="https://blog.csdn.net/u012005313/article/details/46916559" target="_blank" rel="noopener">opencv 灰度直方图 一维直方图</a></li></ul><p>颜色/纹理等特征通过直方图的形式能够有效的作用于图像检测/识别算法，所以打算再整理一下相关的概念和实现。参考：</p><ul><li><a href="https://docs.opencv.org/4.0.1/d4/d1b/tutorial_histogram_equalization.html" target="_blank" rel="noopener">Histogram Equalization</a></li><li><a href="https://docs.opencv.org/4.0.1/d8/dbc/tutorial_histogram_calculation.html" target="_blank" rel="noopener">Histogram Calculation</a></li><li><p><a href="https://docs.opencv.org/4.0.1/d8/dc8/tutorial_histogram_comparison.html" target="_blank" rel="noopener">Histogram Comparison</a></p></li><li><p>头文件地址：<code>/path/to/opencv-4.0.1/modules/imgproc/include/opencv2/imgproc.hpp</code></p></li><li>源文件地址：<code>/path/to/opencv-4.0.1/modules/imgproc/src/histogram.cpp</code></li></ul><h2 id="内容列表"><a href="#内容列表" class="headerlink" title="内容列表"></a>内容列表</h2><ul><li>什么是直方图？</li><li>直方图计算</li><li>直方图均衡</li><li>直方图比较</li></ul><h2 id="什么是直方图？"><a href="#什么是直方图？" class="headerlink" title="什么是直方图？"></a>什么是直方图？</h2><ul><li>直方图（<code>histogram</code>）统计不同强度下的像素数目。直方图的最小单位是<code>bin</code>（箱）</li><li>强度通常指像素颜色值（颜色直方图）。但并不将其限制为颜色强度值，可以是任何对描述图像有用的特征，比如纹理特征（纹理直方图）</li></ul><h3 id="颜色直方图示例"><a href="#颜色直方图示例" class="headerlink" title="颜色直方图示例"></a>颜色直方图示例</h3><p>假设图像及其像素灰度值大小如下：</p><p><img src="/imgs/直方图/Histogram_Calculation_Theory_Hist0.jpg" alt></p><p>灰度值的取值范围在<code>[0, 255]</code>，每<code>15</code>个强度值划为一组，共得到<code>16</code>个子块</p><script type="math/tex;mode=display">
[0,255]=[0,15]∪[16,31]∪....∪[240,255]</script><script type="math/tex;mode=display">
range=bin_{1} ∪ bin_{2} ∪ .... ∪ bin_{n}=15</script><p>统计每个子块中的像素个数，得到的就是颜色直方图。图形化显示如下（<code>x</code>轴表示<code>bin</code>，<code>y</code>轴表示像素个数）</p><p><img src="/imgs/直方图/Histogram_Calculation_Theory_Hist1.jpg" alt></p><h3 id="关键参数"><a href="#关键参数" class="headerlink" title="关键参数"></a>关键参数</h3><p>直方图有<code>3</code>个关键参数：</p><ul><li><code>dims</code>：要收集数据的参数数量。在上式灰度图像中，仅收集每个像素的强度值（灰度值），所以<code>dims=1</code></li><li><code>bins</code>：每个<code>dim</code>中根据强度级别划分的子块数。上式中，灰度值取值范围在<code>[0,255]</code>，每<code>15</code>个强度值划为一组，共得到<code>16</code>个<code>bin</code> - <code>bins=16</code></li><li><code>range</code>：要测量的值的取值范围。上式中，要测量灰度值，取值为<code>[0,255]</code></li></ul><h3 id="直方图的作用"><a href="#直方图的作用" class="headerlink" title="直方图的作用"></a>直方图的作用</h3><ul><li>它表示了图像强度分布</li><li>它量化了每个强度值的像素数</li></ul><p>所以使用直方图能够统计数据的全局信息</p><h2 id="直方图计算"><a href="#直方图计算" class="headerlink" title="直方图计算"></a>直方图计算</h2><p>参考：<a href="https://docs.opencv.org/4.0.1/d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d" target="_blank" rel="noopener">calcHist() [1/3]</a></p><p>实现步骤如下：</p><ol><li>加载图像</li><li>分离彩色图像到<code>R/G/B</code>通道</li><li>计算每个通道的颜色直方图</li><li>在同一图上绘制<code>3</code>个颜色直方图</li></ol><p><code>OpenCV</code>提供了<a href="https://docs.opencv.org/4.0.1/d6/dc7/group__imgproc__hist.html#ga4b2b5fd75503ff9e6844cc4dcdaed35d" target="_blank" rel="noopener">cv::calcHist</a>用于直方图计算</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CV_EXPORTS void calcHist( const Mat* images, int nimages,</span><br><span class="line">                          const int* channels, InputArray mask,</span><br><span class="line">                          OutputArray hist, int dims, const int* histSize,</span><br><span class="line">                          const float** ranges, bool uniform = true, bool accumulate = false );</span><br></pre></td></tr></table></figure><ul><li><code>images</code>：原图数组。应该具有相同的深度（<code>CV_8U、CV_16U或CV_32F</code>）以及相同的尺寸。每个图像可以有任意数量的通道</li><li><code>nimages</code>：图像个数</li><li><code>channels</code>：用于计算直方图的<code>dims</code>通道列表。第一个列表值表示计算第一张图像的前几个通道；第二个列表值表示计算第二张图像的前几个通道，最后累加到一起得到直方图</li><li><code>mask</code>：可选。如果矩阵不是空的，它必须是一个<code>8</code>位数组，大小与<code>images[i]</code>相同。非零掩码元素标记会被直方图计数的数组元素（<em>比如仅计算图像中某一区域的直方图</em>）</li><li><code>hist</code>：输出直方图</li><li><code>dims</code>：直方图维数，必须是正数，不大于<code>CV_MAX_DIMS</code>（当前取值为<code>32</code>）</li><li><code>histSize</code>：每个维度的直方图大小数组</li><li><code>ranges</code>：每个图像的取值范围</li><li><code>uniform</code>：默认为<code>true</code>，表示每张图片计算的直方图是否一致</li><li><code>accumulate</code>：累积标志。如果已设置，直方图在分配时不会在开始时被清除。此功能使您能够从几组数组中计算出一个直方图，或者及时更新直方图</li></ul><p>示例如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;opencv2/highgui.hpp&quot;</span><br><span class="line">#include &quot;opencv2/imgcodecs.hpp&quot;</span><br><span class="line">#include &quot;opencv2/imgproc.hpp&quot;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">using namespace cv;</span><br><span class="line">int main(int argc, char** argv)</span><br><span class="line">&#123;</span><br><span class="line">    CommandLineParser parser( argc, argv, &quot;&#123;@input | ../data/lena.jpg | input image&#125;&quot; );</span><br><span class="line">    Mat src = imread( parser.get&lt;String&gt;( &quot;@input&quot; ), IMREAD_COLOR );</span><br><span class="line">    if( src.empty() )</span><br><span class="line">    &#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;Mat&gt; bgr_planes;</span><br><span class="line">    split( src, bgr_planes );</span><br><span class="line">    int histSize = 256;</span><br><span class="line">    float range[] = &#123; 0, 256 &#125;; //the upper boundary is exclusive</span><br><span class="line">    const float* histRange = &#123; range &#125;;</span><br><span class="line">    bool uniform = true, accumulate = false;</span><br><span class="line">    Mat b_hist, g_hist, r_hist;</span><br><span class="line">    calcHist( &amp;bgr_planes[0], 1, 0, Mat(), b_hist, 1, &amp;histSize, &amp;histRange, uniform, accumulate );</span><br><span class="line">    calcHist( &amp;bgr_planes[1], 1, 0, Mat(), g_hist, 1, &amp;histSize, &amp;histRange, uniform, accumulate );</span><br><span class="line">    calcHist( &amp;bgr_planes[2], 1, 0, Mat(), r_hist, 1, &amp;histSize, &amp;histRange, uniform, accumulate );</span><br><span class="line">    int hist_w = 512, hist_h = 400;</span><br><span class="line">    int bin_w = cvRound( (double) hist_w/histSize );</span><br><span class="line">    Mat histImage( hist_h, hist_w, CV_8UC3, Scalar( 0,0,0) );</span><br><span class="line">    normalize(b_hist, b_hist, 0, histImage.rows, NORM_MINMAX, -1, Mat() );</span><br><span class="line">    normalize(g_hist, g_hist, 0, histImage.rows, NORM_MINMAX, -1, Mat() );</span><br><span class="line">    normalize(r_hist, r_hist, 0, histImage.rows, NORM_MINMAX, -1, Mat() );</span><br><span class="line">    for( int i = 1; i &lt; histSize; i++ )</span><br><span class="line">    &#123;</span><br><span class="line">        line( histImage, Point( bin_w*(i-1), hist_h - cvRound(b_hist.at&lt;float&gt;(i-1)) ),</span><br><span class="line">              Point( bin_w*(i), hist_h - cvRound(b_hist.at&lt;float&gt;(i)) ),</span><br><span class="line">              Scalar( 255, 0, 0), 2, 8, 0  );</span><br><span class="line">        line( histImage, Point( bin_w*(i-1), hist_h - cvRound(g_hist.at&lt;float&gt;(i-1)) ),</span><br><span class="line">              Point( bin_w*(i), hist_h - cvRound(g_hist.at&lt;float&gt;(i)) ),</span><br><span class="line">              Scalar( 0, 255, 0), 2, 8, 0  );</span><br><span class="line">        line( histImage, Point( bin_w*(i-1), hist_h - cvRound(r_hist.at&lt;float&gt;(i-1)) ),</span><br><span class="line">              Point( bin_w*(i), hist_h - cvRound(r_hist.at&lt;float&gt;(i)) ),</span><br><span class="line">              Scalar( 0, 0, 255), 2, 8, 0  );</span><br><span class="line">    &#125;</span><br><span class="line">    imshow(&quot;Source image&quot;, src );</span><br><span class="line">    imshow(&quot;calcHist Demo&quot;, histImage );</span><br><span class="line">    waitKey();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="直方图均衡"><a href="#直方图均衡" class="headerlink" title="直方图均衡"></a>直方图均衡</h2><p>参考：</p><p><a href="https://en.wikipedia.org/wiki/Histogram_equalization" target="_blank" rel="noopener">Histogram equalization</a></p><p><a href="https://zhuanlan.zhihu.com/p/89598106" target="_blank" rel="noopener">直方图均衡化</a></p><p>直方图均衡通过扩展像素取值范围，能够提高图像对比度</p><p>均衡意味着将一个分布(给定直方图)映射到另一个分布(更宽和更均匀的分布)，以便强度值分布在整个范围内</p><h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><p>第一步：统计灰度直方图</p><p>第二步：计算每一级灰度的概率</p><script type="math/tex;mode=display">
p_{x}(i) = p(x=i) = \frac {n_{i}}{n}, 0\leq i < L</script><p>其中$L$表示灰度级数（通常为$256$），$n$表示图像像素个数，$p_{x}(i)$表示直方图中像素值为$i$的概率</p><p>第三步：计算累积分布函数<code>cdf(cumulative distribution function)</code></p><script type="math/tex;mode=display">
cdf_{x}(i) = \sum_{j=0}^{i}p_{x}(j)</script><p>第四步：求取映射像素值</p><script type="math/tex;mode=display">
s_{i} = T(r_{i}) = round((L-1)*cdf_{x}(i) + 0.5)</script><ul><li>函数$T$表示映射函数</li><li>函数$round$表示去除小数部分取整数</li><li>$(L-1)*cdf_{x}(i)$表示将像素值扩展回原先的级数</li></ul><p>经过第四步计算完成后就能够得到直方图均衡后的结果</p><h3 id="OpenCV使用"><a href="#OpenCV使用" class="headerlink" title="OpenCV使用"></a>OpenCV使用</h3><p><code>OpenCV</code>提供了函数<a href="https://docs.opencv.org/4.0.1/d6/dc7/group__imgproc__hist.html#ga7e54091f0c937d49bf84152a16f76d6e" target="_blank" rel="noopener">equalizeHist()</a>进行直方图均衡化的操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CV_EXPORTS_W void equalizeHist( InputArray src, OutputArray dst );</span><br></pre></td></tr></table></figure><p>参数<code>src</code>是一个<code>8</code>位单通道图像，输出<code>dst</code>得到和原图同样大小和类型的结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Mat src = imread(parser.get&lt;String&gt;(&quot;@input&quot;), IMREAD_COLOR);</span><br><span class="line">if (src.empty()) &#123;</span><br><span class="line">    cout &lt;&lt; &quot;Could not open or find the image!\n&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; &lt;Input image&gt;&quot; &lt;&lt; endl;</span><br><span class="line">    return -1;</span><br><span class="line">&#125;</span><br><span class="line">cvtColor(src, src, COLOR_BGR2GRAY);</span><br><span class="line">Mat dst;</span><br><span class="line">equalizeHist(src, dst);</span><br><span class="line"></span><br><span class="line">imshow(&quot;Source image&quot;, src);</span><br><span class="line">imshow(&quot;Equalized Image&quot;, dst);</span><br><span class="line">waitKey();</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="直方图比较"><a href="#直方图比较" class="headerlink" title="直方图比较"></a>直方图比较</h2><p>参考：<a href="https://docs.opencv.org/4.0.1/d6/dc7/group__imgproc__hist.html#ga994f53817d621e2e4228fc646342d386" target="_blank" rel="noopener">HistCompMethods</a></p><p>直方图比较的目的是计算两个直方图的匹配程度</p><p><code>OpenCV</code>提供了四种比较方式</p><ol><li><code>Correlation</code></li><li><code>Chi-Square</code></li><li><code>Intersection</code>（直方图相交）</li><li><code>Bhattacharyya distance</code></li></ol><h3 id="直方图相交"><a href="#直方图相交" class="headerlink" title="直方图相交"></a>直方图相交</h3><p>计算公式如下：</p><script type="math/tex;mode=display">
d(H_{1}, H_{2}) = \sum_{I} \min (H_{1}(I), H_{2}(I))</script><p>$H_{1}$和$H_{2}$是两个直方图</p><h3 id="操作步骤-1"><a href="#操作步骤-1" class="headerlink" title="操作步骤"></a>操作步骤</h3><p>参考：<a href="https://blog.csdn.net/l740450789/article/details/47124643" target="_blank" rel="noopener">颜色直方图，HSV直方图</a></p><ol><li>加载两张比较图像</li><li>转换成<code>HSV</code>格式，计算<code>H-S</code>直方图</li><li>使用直方图比较方式进行计算</li><li>输出匹配数值</li></ol><p>将图像转换成<code>HSV</code>格式后再进行直方图比较，更能够符合人眼对颜色相似性的主观判断</p><h3 id="OpenCV示例"><a href="#OpenCV示例" class="headerlink" title="OpenCV示例"></a>OpenCV示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    Mat src_base = imread(path);</span><br><span class="line">    Mat src_test = imread(path2);</span><br><span class="line">    if (src_base.empty() || src_test.empty()) &#123;</span><br><span class="line">        cout &lt;&lt; &quot;Could not open or find the images!\n&quot; &lt;&lt; endl;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mat hsv_base, hsv_test1;</span><br><span class="line">    cvtColor(src_base, hsv_base, COLOR_BGR2HSV);</span><br><span class="line">    cvtColor(src_test, hsv_test1, COLOR_BGR2HSV);</span><br><span class="line"></span><br><span class="line">    int h_bins = 50, s_bins = 60;</span><br><span class="line">    int histSize[] = &#123;h_bins, s_bins&#125;;</span><br><span class="line">    // hue varies from 0 to 179, saturation from 0 to 255</span><br><span class="line">    float h_ranges[] = &#123;0, 180&#125;;</span><br><span class="line">    float s_ranges[] = &#123;0, 256&#125;;</span><br><span class="line">    const float *ranges[] = &#123;h_ranges, s_ranges&#125;;</span><br><span class="line">    // Use the 0-th and 1-st channels</span><br><span class="line">    int channels[] = &#123;0, 1&#125;;</span><br><span class="line"></span><br><span class="line">    Mat hist_base, hist_test;</span><br><span class="line">    calcHist(&amp;hsv_base, 1, channels, Mat(), hist_base, 2, histSize, ranges, true, false);</span><br><span class="line">    normalize(hist_base, hist_base, 0, 1, NORM_MINMAX, -1, Mat());</span><br><span class="line"></span><br><span class="line">    calcHist(&amp;hsv_test1, 1, channels, Mat(), hist_test, 2, histSize, ranges, true, false);</span><br><span class="line">    normalize(hist_test, hist_test, 0, 1, NORM_MINMAX, -1, Mat());</span><br><span class="line"></span><br><span class="line">    double base_test = compareHist(hist_base, hist_test, HISTCMP_INTERSECT);</span><br><span class="line">    cout &lt;&lt; &quot;Method HISTCMP_INTERSECT : &quot; &lt;&lt; base_test &lt;&lt; endl;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="手动实现直方图计算"><a href="#手动实现直方图计算" class="headerlink" title="手动实现直方图计算"></a>手动实现直方图计算</h2><p>直方图计算主要涉及<code>cv::calcHist</code>和<code>cv::normalize</code>的使用。完整代码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// Created by zj on 19-11-24.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#include &quot;opencv2/highgui.hpp&quot;</span><br><span class="line">#include &quot;opencv2/imgcodecs.hpp&quot;</span><br><span class="line">#include &quot;opencv2/imgproc.hpp&quot;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;array&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">using namespace cv;</span><br><span class="line"></span><br><span class="line">const static array&lt;Scalar, 3&gt; colors = &#123;</span><br><span class="line">        Scalar(255, 0, 0),</span><br><span class="line">        Scalar(0, 255, 0),</span><br><span class="line">        Scalar(0, 0, 255)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 计算颜色直方图，图像取值固定为[0, 255]</span><br><span class="line"> * @param src CV_8UC1或CV_8UC3大小图像</span><br><span class="line"> * @param histograms 直方图向量</span><br><span class="line"> * @param bins 直方图大小</span><br><span class="line"> */</span><br><span class="line">void calc_color_hist(const Mat &amp;src, vector&lt;Mat&gt; &amp;histograms, int bins) &#123;</span><br><span class="line">    int channels = src.channels();</span><br><span class="line">    vector&lt;Mat&gt; img_planes;</span><br><span class="line">    if (channels == 3) &#123;</span><br><span class="line">        split(src, img_planes);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // gray</span><br><span class="line">        img_planes.emplace_back(src);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    float range[] = &#123;0, 256&#125;; //the upper boundary is exclusive</span><br><span class="line">    const float *histRange = &#123;range&#125;;</span><br><span class="line">    bool uniform = true, accumulate = false;</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; channels; i++) &#123;</span><br><span class="line">        Mat hist;</span><br><span class="line">        calcHist(&amp;img_planes[i], 1, nullptr, Mat(), hist, 1, &amp;bins, &amp;histRange, uniform, accumulate);</span><br><span class="line">//        cout &lt;&lt; hist.type() &lt;&lt; endl;</span><br><span class="line">        histograms.emplace_back(hist);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 绘制直方图，首先对直方图标准化，再按比例绘制线条</span><br><span class="line"> */</span><br><span class="line">void draw_color_hist(const vector&lt;Mat&gt; &amp;histograms, Mat &amp;histImage, int bins) &#123;</span><br><span class="line">    int hist_w = 512, hist_h = 400;</span><br><span class="line">    histImage = Mat(hist_h, hist_w, CV_8UC3, Scalar(0, 0, 0));</span><br><span class="line"></span><br><span class="line">    int bin_w = cvRound((double) hist_w / bins);</span><br><span class="line">    for (int i = 0; i &lt; histograms.size(); i++) &#123;</span><br><span class="line">        Mat hist = histograms[i];</span><br><span class="line">        Mat hist_tmp;</span><br><span class="line">        // 标准化直方图，取值为[0.0, hist_h]</span><br><span class="line">        normalize(hist, hist_tmp, 0, histImage.rows, NORM_MINMAX, -1, Mat());</span><br><span class="line">//        cout &lt;&lt; hist_tmp.type() &lt;&lt; endl;</span><br><span class="line">        Scalar color = colors[i % colors.size()];</span><br><span class="line">        for (int i = 1; i &lt; bins; i++) &#123;</span><br><span class="line">            line(histImage,</span><br><span class="line">                 Point(bin_w * (i - 1), hist_h - cvRound(hist_tmp.at&lt;float&gt;(i - 1))),</span><br><span class="line">                 Point(bin_w * (i), hist_h - cvRound(hist_tmp.at&lt;float&gt;(i))),</span><br><span class="line">                 color,</span><br><span class="line">                 2, 8, 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 手动计算颜色直方图</span><br><span class="line"> * @param src CV_8UC1或CV_8UC3</span><br><span class="line"> * @param histograms 颜色直方图向量</span><br><span class="line"> * @param bins 直方图大小</span><br><span class="line"> */</span><br><span class="line">void calc_color_hist_manully(const Mat &amp;src, vector&lt;Mat&gt; &amp;histograms, int bins) &#123;</span><br><span class="line">    int channels = src.channels();</span><br><span class="line">    float ranges[] = &#123;0.0, 256.0&#125;;</span><br><span class="line">    // 计算每个bin的取值范围</span><br><span class="line">    double range = (ranges[1] - ranges[0]) / bins;</span><br><span class="line"></span><br><span class="line">    // 分离图像</span><br><span class="line">    vector&lt;Mat&gt; img_planes;</span><br><span class="line">    if (channels == 1) &#123;</span><br><span class="line">        img_planes.emplace_back(src);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 分离3通道</span><br><span class="line">        split(src, img_planes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 遍历所有通道，计算颜色直方图</span><br><span class="line">    for (int i = 0; i &lt; channels; i++) &#123;</span><br><span class="line">        Mat hist = Mat::zeros(1, bins, CV_32F);</span><br><span class="line">        auto *hdata = hist.ptr&lt;float&gt;(0);</span><br><span class="line"></span><br><span class="line">        Mat plane = img_planes[i];</span><br><span class="line">        // 遍历所有像素，从左到右，从上到下</span><br><span class="line">        for (int y = 0; y &lt; plane.rows; y++) &#123;</span><br><span class="line">            auto *pdata = plane.ptr&lt;uchar&gt;(y);</span><br><span class="line"></span><br><span class="line">            for (int x = 0; x &lt; plane.cols; x++) &#123;</span><br><span class="line">                hdata[cvFloor(static_cast&lt;int&gt;(pdata[x]) / range)] += 1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        histograms.emplace_back(hist);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 绘制直方图，首先手动对直方图标准化，再按比例绘制线条</span><br><span class="line"> * @param histograms 直方图列表</span><br><span class="line"> * @param histImage 绘制直方图</span><br><span class="line"> * @param bins 直方图大小</span><br><span class="line"> */</span><br><span class="line">void draw_color_hist_manully(const vector&lt;Mat&gt; &amp;histograms, Mat &amp;histImage, int bins) &#123;</span><br><span class="line">    int hist_w = 512, hist_h = 400;</span><br><span class="line">    histImage = Mat(hist_h, hist_w, CV_8UC3, Scalar(0, 0, 0));</span><br><span class="line"></span><br><span class="line">    auto channels = histograms.size();</span><br><span class="line"></span><br><span class="line">    // 手动标准化直方图</span><br><span class="line">    vector&lt;Mat&gt; hist_tmps;</span><br><span class="line">    for (int i = 0; i &lt; channels; i++) &#123;</span><br><span class="line">        double min, max;</span><br><span class="line">        cv::minMaxLoc(histograms[i], &amp;min, &amp;max);</span><br><span class="line">        Mat hist_tmp = Mat::zeros(histograms[i].size(), CV_32F);</span><br><span class="line"></span><br><span class="line">        auto *hdata = histograms[i].ptr&lt;float&gt;(0);</span><br><span class="line">        auto *hdata_tmp = hist_tmp.ptr&lt;float&gt;(0);</span><br><span class="line">        for (int j = 0; j &lt; bins; j++) &#123;</span><br><span class="line">            hdata_tmp[j] = static_cast&lt;float&gt;(hist_h * (hdata[j] - min) / (max - min));</span><br><span class="line">        &#125;</span><br><span class="line">        hist_tmps.emplace_back(hist_tmp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int bin_w = cvRound(1.0 * hist_w / bins);</span><br><span class="line">    for (int i = 0; i &lt; channels; i++) &#123;</span><br><span class="line">        Scalar color = colors[i % colors.size()];</span><br><span class="line">        auto *hdata = hist_tmps[i].ptr&lt;float&gt;(0);</span><br><span class="line"></span><br><span class="line">        for (int j = 1; j &lt; bins; j++) &#123;</span><br><span class="line">            line(histImage,</span><br><span class="line">                 Point(bin_w * (j - 1), cvRound(hist_h - hdata[j - 1])),</span><br><span class="line">                 Point(bin_w * (j), cvRound(hist_h - hdata[j])),</span><br><span class="line">                 color,</span><br><span class="line">                 2, 8, 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">    CommandLineParser parser(argc, argv, &quot;&#123;@input | ../lena.jpg | input image&#125;&quot;);</span><br><span class="line">    Mat src = imread(parser.get&lt;String&gt;(&quot;@input&quot;), IMREAD_COLOR);</span><br><span class="line">    if (src.empty()) &#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//    Mat gray;</span><br><span class="line">//    cvtColor(src, gray, COLOR_BGR2GRAY);</span><br><span class="line">//    src = gray;</span><br><span class="line"></span><br><span class="line">    int bins = 256;</span><br><span class="line">    vector&lt;Mat&gt; histograms, histograms2;</span><br><span class="line">    Mat histImage, histImage2;</span><br><span class="line"></span><br><span class="line">    // 调用OpenCV提供的直方图计算和标准化函数</span><br><span class="line">    double t1 = (double) getTickCount();</span><br><span class="line">    calc_color_hist(src, histograms, bins);</span><br><span class="line">    draw_color_hist(histograms, histImage, bins);</span><br><span class="line">    // 手动计算和标准化直方图</span><br><span class="line">    double t2 = (double) getTickCount();</span><br><span class="line">    calc_color_hist_manully(src, histograms2, bins);</span><br><span class="line">    draw_color_hist_manully(histograms2, histImage2, bins);</span><br><span class="line">    double t3 = (double) getTickCount();</span><br><span class="line"></span><br><span class="line">    double time1 = (t2 - t1) / getTickFrequency();</span><br><span class="line">    double time2 = (t3 - t2) / getTickFrequency();</span><br><span class="line">    cout &lt;&lt; time1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; time2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    // 判断绘制图像是否相等</span><br><span class="line">    cv::Mat diff = histImage != histImage2;</span><br><span class="line">    cout &lt;&lt; sum(diff) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    imshow(&quot;Source image&quot;, src);</span><br><span class="line">    imshow(&quot;OpenCV API&quot;, histImage);</span><br><span class="line">    imshow(&quot;手动实现&quot;, histImage2);</span><br><span class="line">    waitKey();</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/imgs/直方图/baboon.jpg" alt></p><p><img src="/imgs/直方图/draw_hist.png" alt></p></div><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/wechatpay.jpg" alt="zhujian 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/images/alipay.jpg" alt="zhujian 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> zhujian</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.zhujian.tech/posts/f1eacfb6.html" title="直方图">https://www.zhujian.tech/posts/f1eacfb6.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/c/" rel="tag"># c++</a> <a href="/tags/opencv/" rel="tag"># opencv</a> <a href="/tags/color-histogram/" rel="tag"># 颜色直方图</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/815ea453.html" rel="next" title="[译]Selective Search for Object Detection (C++/Python)"><i class="fa fa-chevron-left"></i> [译]Selective Search for Object Detection (C++/Python)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/202ee452.html" rel="prev" title="在Docker中运行Jenkins">在Docker中运行Jenkins<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#内容列表"><span class="nav-number">1.</span> <span class="nav-text">内容列表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是直方图？"><span class="nav-number">2.</span> <span class="nav-text">什么是直方图？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#颜色直方图示例"><span class="nav-number">2.1.</span> <span class="nav-text">颜色直方图示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关键参数"><span class="nav-number">2.2.</span> <span class="nav-text">关键参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#直方图的作用"><span class="nav-number">2.3.</span> <span class="nav-text">直方图的作用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直方图计算"><span class="nav-number">3.</span> <span class="nav-text">直方图计算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直方图均衡"><span class="nav-number">4.</span> <span class="nav-text">直方图均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#操作步骤"><span class="nav-number">4.1.</span> <span class="nav-text">操作步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenCV使用"><span class="nav-number">4.2.</span> <span class="nav-text">OpenCV使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直方图比较"><span class="nav-number">5.</span> <span class="nav-text">直方图比较</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#直方图相交"><span class="nav-number">5.1.</span> <span class="nav-text">直方图相交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#操作步骤-1"><span class="nav-number">5.2.</span> <span class="nav-text">操作步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenCV示例"><span class="nav-number">5.3.</span> <span class="nav-text">OpenCV示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#手动实现直方图计算"><span class="nav-number">6.</span> <span class="nav-text">手动实现直方图计算</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="zhujian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">zhujian</p><div class="site-description" itemprop="description">one bite at a time</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">169</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">48</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">129</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="feed-link motion-element"><a href="/./atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zjZSTU" title="Github &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;zjZSTU" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/u012005313" title="CSDN &amp;rarr; https:&#x2F;&#x2F;blog.csdn.net&#x2F;u012005313" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> CSDN</a></span><span class="links-of-author-item"><a href="/mailto:zjzstu@gmail.com" title="Gmail &amp;rarr; mailto:zjzstu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> Gmail</a></span><span class="links-of-author-item"><a href="/mailto:505169307@gmail.com" title="QQmail &amp;rarr; mailto:505169307@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> QQmail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://cloud.tencent.com/" title="https:&#x2F;&#x2F;cloud.tencent.com" rel="noopener" target="_blank">腾讯云</a></li><li class="links-of-blogroll-item"> <a href="https://www.aliyun.com/" title="https:&#x2F;&#x2F;www.aliyun.com" rel="noopener" target="_blank">阿里云</a></li><li class="links-of-blogroll-item"> <a href="https://developer.android.com/" title="https:&#x2F;&#x2F;developer.android.com&#x2F;" rel="noopener" target="_blank">Android Dev</a></li><li class="links-of-blogroll-item"> <a href="https://jenkins.io/" title="https:&#x2F;&#x2F;jenkins.io&#x2F;" rel="noopener" target="_blank">Jenkins</a></li><li class="links-of-blogroll-item"> <a href="http://cs231n.github.io/" title="http:&#x2F;&#x2F;cs231n.github.io&#x2F;" rel="noopener" target="_blank">cs231n</a></li><li class="links-of-blogroll-item"> <a href="https://pytorch.org/docs/stable/index.html" title="https:&#x2F;&#x2F;pytorch.org&#x2F;docs&#x2F;stable&#x2F;index.html" rel="noopener" target="_blank">pytorch</a></li><li class="links-of-blogroll-item"> <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" title="https:&#x2F;&#x2F;docs.docker.com&#x2F;install&#x2F;linux&#x2F;docker-ce&#x2F;ubuntu&#x2F;" rel="noopener" target="_blank">docker</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">zhujian</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">948k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">26:20</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-bar-chart-o"></i></span> <a href="https://tongji.baidu.com/web/27249108/overview/index?siteId=13647183" rel="noopener" target="_blank">百度统计</a></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0</div><div class="beian"> <a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备 19026415号</a> <span class="post-meta-divider">|</span> <img src="/images/beian_icon.png" style="display:inline-block;text-decoration:none;height:13px"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011802001748" rel="noopener" target="_blank">浙公网安备 33011802001748号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span> <span class="site-uv" title="总访客量">访客数：<span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="site-pv" title="总访问量">阅读量：<span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="17,63,61" opacity="1" zindex="-1" count="199" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '8f22595c6dd29c94467d',
      clientSecret: 'e66bd90ebb9aa66c562c753dec6c90ceecbd51f2',
      repo: 'guestbook',
      owner: 'zjZSTU',
      admin: ['zjZSTU'],
      id: '01db1e861125697655aa6869719bcbbe',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script></body></html>