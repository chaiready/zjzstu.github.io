<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="alternate" href="/./atom.xml" title="做一个幸福的人" type="application/atom+xml"><meta name="google-site-verification" content="Qr_3yqLtyErDFKHW7mE8PJz4qDUX-bf_fMLpSRckQe4"><meta name="baidu-site-verification" content="zOwIvKMV7f"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.5.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"搜索文章",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap" rel="stylesheet"><meta name="description" content="学习SelectiveSearch算法时候，其纹理特征需要计算类SIFT特征，实现方式是计算每张图片8个方向上10 bin大小的高斯导数直方图"><meta name="keywords" content="c++,opencv,颜色直方图,纹理特征"><meta property="og:type" content="article"><meta property="og:title" content="[OpenCV][纹理特征]如何计算不同方向下的高斯导数直方图"><meta property="og:url" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;posts&#x2F;b03366b0.html"><meta property="og:site_name" content="做一个幸福的人"><meta property="og:description" content="学习SelectiveSearch算法时候，其纹理特征需要计算类SIFT特征，实现方式是计算每张图片8个方向上10 bin大小的高斯导数直方图"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2020-02-15T05:36:35.871Z"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.zhujian.tech/posts/b03366b0.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>[OpenCV][纹理特征]如何计算不同方向下的高斯导数直方图 | 做一个幸福的人</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e677aac1ac69b8826b9cfecb4e72e107";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">做一个幸福的人</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">面朝大海，春暖花开</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签<span class="badge">129</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类<span class="badge">48</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档<span class="badge">169</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header> <a href="https://github.com/zjZSTU" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zhujian.tech/posts/b03366b0.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="zhujian"><meta itemprop="description" content="one bite at a time"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="做一个幸福的人"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> [OpenCV][纹理特征]如何计算不同方向下的高斯导数直方图</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-11-25 20:56:01" itemprop="dateCreated datePublished" datetime="2019-11-25T20:56:01+00:00">2019-11-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-02-15 05:36:35" itemprop="dateModified" datetime="2020-02-15T05:36:35+00:00">2020-02-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/image-process/" itemprop="url" rel="index"><span itemprop="name">图像处理</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/programming-language/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/image-process/histogram/" itemprop="url" rel="index"><span itemprop="name">直方图</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/codebase/" itemprop="url" rel="index"><span itemprop="name">代码库</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/image-process/feature/" itemprop="url" rel="index"><span itemprop="name">特征</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5.5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>9 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>学习<code>SelectiveSearch</code>算法时候，其纹理特征需要计算类<code>SIFT</code>特征，实现方式是计算每张图片<code>8</code>个方向上<code>10 bin</code>大小的高斯导数直方图</p><a id="more"></a><blockquote><p>$S_{texture}(r_{i}, r_{j})$ measures texture similarity. We represent texture using fast SIFT-like measurements as SIFT itself works well for material recognition [20]. We take Gaussian derivatives in eight orientations using $σ = 1$ for each colour channel. For each orientation for each colour channel we extract a histogram using a bin size of 10. This leads to a texture histogram $T_{i} = {t_{i}^{1}, …, t_{i}^{n}}$ for each region $r_{i}$ with dimensionality $n = 240$ when three colour channels are used. Texture histograms are normalised using the $L_{1}$ norm. Similarity is measured using histogram intersection:</p></blockquote><p><code>OpenCV</code>实现了<code>SelectiveSearch</code>算法，其通过图像旋转、<code>Scharr</code>滤波以及手动计算直方图的方式完成了纹理特征的计算。之前没有思考过如何完成不同方向下导数直方图的计算，学习里面代码实现不同方向下的导数直方图计算</p><p>源码地址：<code>opencv_contrib/modules/ximgproc/src/selectivesearchsegmentation.cpp</code></p><h2 id="完整流程"><a href="#完整流程" class="headerlink" title="完整流程"></a>完整流程</h2><ol><li>计算高斯导数</li><li>计算直方图</li><li>直方图连接</li></ol><h2 id="计算高斯导数"><a href="#计算高斯导数" class="headerlink" title="计算高斯导数"></a>计算高斯导数</h2><p>需要分别计算<code>8</code>个方向上的高斯导数，分别是</p><ol><li><code>x</code>轴正/负方向</li><li><code>y</code>轴正/负方向</li><li>图像逆时针<code>45</code>度旋转后<code>x</code>轴正/负方向</li><li>图像逆时针<code>45</code>度旋转后<code>y</code>轴正/负方向</li></ol><p>使用函数<code>Scharr</code>对图像进行高斯求导，然后通过阈值函数<code>threshold</code>获取正/负方向的求导结果</p><p>完成上述操作后将结果进行标准化（<code>[0,255]</code>），以便后续直方图的计算。实现代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 计算8个方向的高斯导数</span><br><span class="line"> * @param src CV_8UC1</span><br><span class="line"> * @param gauss_vector</span><br><span class="line"> */</span><br><span class="line">void calc_8_direction_guass(const Mat &amp;src, vector&lt;Mat&gt; &amp;gauss_vector) &#123;</span><br><span class="line">//    cout &lt;&lt; src.channels() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Mat gauss, gauss_pos, gauss_neg;</span><br><span class="line">    Mat rotated, rotated_gauss;</span><br><span class="line">    Mat rotated_gauss_tmp;</span><br><span class="line"></span><br><span class="line">    // x轴，向左/向右</span><br><span class="line">    Scharr(src, gauss, CV_32F, 1, 0);</span><br><span class="line">    threshold(gauss, gauss_pos, 0, 0, THRESH_TOZERO);</span><br><span class="line">    threshold(gauss, gauss_neg, 0, 0, THRESH_TOZERO_INV);</span><br><span class="line">    gauss_vector.emplace_back(gauss_pos);</span><br><span class="line">    gauss_vector.emplace_back(gauss_neg);</span><br><span class="line"></span><br><span class="line">    // y轴，向上/向下</span><br><span class="line">    gauss.release();</span><br><span class="line">    Scharr(src, gauss, CV_32F, 0, 1);</span><br><span class="line"></span><br><span class="line">    gauss_pos.release();</span><br><span class="line">    gauss_neg.release();</span><br><span class="line">    threshold(gauss, gauss_pos, 0, 0, THRESH_TOZERO);</span><br><span class="line">    threshold(gauss, gauss_neg, 0, 0, THRESH_TOZERO_INV);</span><br><span class="line">    gauss_vector.emplace_back(gauss_pos);</span><br><span class="line">    gauss_vector.emplace_back(gauss_neg);</span><br><span class="line"></span><br><span class="line">    // 逆时针旋转45度</span><br><span class="line">    Point2f center(src.cols / 2.0f, src.rows / 2.0f);</span><br><span class="line">    Mat rot = cv::getRotationMatrix2D(center, 45.0, 1.0);</span><br><span class="line">    Rect bbox = cv::RotatedRect(center, src.size(), 45.0).boundingRect();</span><br><span class="line">    rot.at&lt;double&gt;(0, 2) += bbox.width / 2.0 - center.x;</span><br><span class="line">    rot.at&lt;double&gt;(1, 2) += bbox.height / 2.0 - center.y;</span><br><span class="line">    warpAffine(src, rotated, rot, bbox.size());</span><br><span class="line">//    cout &lt;&lt; rotated.size() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    // 计算x轴方向导数</span><br><span class="line">    Scharr(rotated, rotated_gauss, CV_32F, 1, 0);</span><br><span class="line"></span><br><span class="line">    // 顺时针旋转45度，获取原先图像大小</span><br><span class="line">    center = Point((int) (rotated.cols / 2.0), (int) (rotated.rows / 2.0));</span><br><span class="line">    rot = cv::getRotationMatrix2D(center, -45.0, 1.0);</span><br><span class="line">    warpAffine(rotated_gauss, rotated_gauss_tmp, rot, bbox.size());</span><br><span class="line">    gauss = rotated_gauss_tmp(Rect((bbox.width - src.cols) / 2,</span><br><span class="line">                                   (bbox.height - src.rows) / 2, src.cols, src.rows));</span><br><span class="line">    gauss_pos.release();</span><br><span class="line">    gauss_neg.release();</span><br><span class="line">    threshold(gauss, gauss_pos, 0, 0, THRESH_TOZERO);</span><br><span class="line">    threshold(gauss, gauss_neg, 0, 0, THRESH_TOZERO_INV);</span><br><span class="line">    gauss_vector.emplace_back(gauss_pos);</span><br><span class="line">    gauss_vector.emplace_back(gauss_neg);</span><br><span class="line"></span><br><span class="line">    // 重复上一步骤</span><br><span class="line">    rotated_gauss.release();</span><br><span class="line">    Scharr(rotated, rotated_gauss, CV_32F, 0, 1);</span><br><span class="line"></span><br><span class="line">    // 顺时针旋转45度，获取原先图像大小</span><br><span class="line">    center = Point((int) (rotated.cols / 2.0), (int) (rotated.rows / 2.0));</span><br><span class="line">    rot = cv::getRotationMatrix2D(center, -45.0, 1.0);</span><br><span class="line">    warpAffine(rotated_gauss, rotated_gauss_tmp, rot, bbox.size());</span><br><span class="line">    gauss = rotated_gauss_tmp(Rect((bbox.width - src.cols) / 2,</span><br><span class="line">                                   (bbox.height - src.rows) / 2, src.cols, src.rows));</span><br><span class="line">    gauss_pos.release();</span><br><span class="line">    gauss_neg.release();</span><br><span class="line">    threshold(gauss, gauss_pos, 0, 0, THRESH_TOZERO);</span><br><span class="line">    threshold(gauss, gauss_neg, 0, 0, THRESH_TOZERO_INV);</span><br><span class="line">    gauss_vector.emplace_back(gauss_pos);</span><br><span class="line">    gauss_vector.emplace_back(gauss_neg);</span><br><span class="line"></span><br><span class="line">    // Normalisze gaussiaans in 0-255 range (for faster computation of histograms)</span><br><span class="line">    // 缩放图像到0-255，方便直方图计算</span><br><span class="line">    for (int i = 0; i &lt; 8; i++) &#123;</span><br><span class="line">        double hmin, hmax;</span><br><span class="line">        minMaxLoc(gauss_vector[i], &amp;hmin, &amp;hmax);</span><br><span class="line"></span><br><span class="line">        Mat tmp;</span><br><span class="line">        gauss_vector[i].convertTo(tmp, CV_8U,</span><br><span class="line">                                  255 / (hmax - hmin),</span><br><span class="line">                                  -255 * hmin / (hmax - hmin));</span><br><span class="line">        gauss_vector[i] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>进行阈值函数操作后直接放入向量中，所以求导图像有正有负</li><li>标准化公式如下：</li></ul><script type="math/tex;mode=display">
y = \frac{255*(x-hmin)}{hmax-hmin}</script><h2 id="计算直方图"><a href="#计算直方图" class="headerlink" title="计算直方图"></a>计算直方图</h2><p>参考：<a href="https://www.zhujian.tech/posts/f1eacfb6.html#more">直方图</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 计算颜色直方图，图像取值固定为[0, 255]</span><br><span class="line"> * @param src CV_8UC1或CV_8UC3大小图像</span><br><span class="line"> * @param histograms 直方图向量</span><br><span class="line"> * @param bins 直方图大小</span><br><span class="line"> */</span><br><span class="line">void calc_color_hist(const Mat &amp;src, vector&lt;Mat&gt; &amp;histograms, int bins) &#123;</span><br><span class="line">    int channels = src.channels();</span><br><span class="line">    vector&lt;Mat&gt; img_planes;</span><br><span class="line">    if (channels == 3) &#123;</span><br><span class="line">        split(src, img_planes);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // gray</span><br><span class="line">        img_planes.emplace_back(src);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    float range[] = &#123;0, 256&#125;; //the upper boundary is exclusive</span><br><span class="line">    const float *histRange = &#123;range&#125;;</span><br><span class="line">    bool uniform = true, accumulate = false;</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; channels; i++) &#123;</span><br><span class="line">        Mat hist, tranpose_hist;</span><br><span class="line">        calcHist(&amp;img_planes[i], 1, nullptr, Mat(), hist, 1, &amp;bins, &amp;histRange, uniform, accumulate);</span><br><span class="line">        //转置图像，得到一行数据</span><br><span class="line">        transpose(hist, tranpose_hist);</span><br><span class="line">        histograms.emplace_back(tranpose_hist);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用<code>OpenCV</code>函数<code>calcHist</code>得到的是<code>N</code>列大小的矩阵，为方便后续计算，将其转置成单行矩阵</p><h2 id="直方图连接"><a href="#直方图连接" class="headerlink" title="直方图连接"></a>直方图连接</h2><p>彩色图像有<code>3</code>个通道，每个通道有<code>8</code>个方向求导，共得到<code>3x8=24</code>个直方图</p><p>对每个求导图像计算<code>10 bin</code>大小的直方图，所以得到的纹理特征维数是<code>24x10=240</code>维</p><p>在连接各个直方图之前，可以先对其进行标准化（<code>[0,1]</code>），以便后续操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">int main() &#123;</span><br><span class="line">    Mat src = imread(&quot;../lena.jpg&quot;);</span><br><span class="line">    Mat gray;</span><br><span class="line">    cvtColor(src, gray, COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">    vector&lt;Mat&gt; img_planes;</span><br><span class="line">    split(src, img_planes);</span><br><span class="line"></span><br><span class="line">    // 得到3x8=24个高斯求导图像，取值范围在[0,255]</span><br><span class="line">    vector&lt;Mat&gt; gauss_vectors;</span><br><span class="line">    for (const Mat &amp;img: img_planes) &#123;</span><br><span class="line">        vector&lt;Mat&gt; gauss_vector;</span><br><span class="line">        calc_8_direction_guass(img, gauss_vector);</span><br><span class="line">        gauss_vectors.insert(gauss_vectors.end(), gauss_vector.begin(), gauss_vector.end());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 计算10 bin大小直方图</span><br><span class="line">    vector&lt;Mat&gt; hists;</span><br><span class="line">    for (const Mat &amp;img: gauss_vectors) &#123;</span><br><span class="line">        vector&lt;Mat&gt; hist;</span><br><span class="line">        calc_color_hist(img, hist, 10);</span><br><span class="line">        hists.insert(hists.end(), hist.begin(), hist.end());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 归一化直方图</span><br><span class="line">    for (const Mat &amp;img: hists) &#123;</span><br><span class="line">        Mat dst;</span><br><span class="line">        img.convertTo(dst, CV_32F, 1.0 / sum(img)[0]);</span><br><span class="line">        cout &lt;&lt; dst &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 按行连接所有矩阵</span><br><span class="line">    cv::Mat out;</span><br><span class="line">    cv::vconcat(hists, out);</span><br><span class="line">    cout &lt;&lt; out &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/wechatpay.jpg" alt="zhujian 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/images/alipay.jpg" alt="zhujian 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> zhujian</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.zhujian.tech/posts/b03366b0.html" title="[OpenCV][纹理特征]如何计算不同方向下的高斯导数直方图">https://www.zhujian.tech/posts/b03366b0.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/c/" rel="tag"># c++</a> <a href="/tags/opencv/" rel="tag"># opencv</a> <a href="/tags/color-histogram/" rel="tag"># 颜色直方图</a> <a href="/tags/texture-feature/" rel="tag"># 纹理特征</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/b79f94c7.html" rel="next" title="[Convolvution][Correlation]卷积和相关的异同"><i class="fa fa-chevron-left"></i> [Convolvution][Correlation]卷积和相关的异同</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/cc213461.html" rel="prev" title="颜色空间小结(RGB/YUV/HSV/Lab/...)">颜色空间小结(RGB/YUV/HSV/Lab/...)<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#完整流程"><span class="nav-number">1.</span> <span class="nav-text">完整流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算高斯导数"><span class="nav-number">2.</span> <span class="nav-text">计算高斯导数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算直方图"><span class="nav-number">3.</span> <span class="nav-text">计算直方图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#直方图连接"><span class="nav-number">4.</span> <span class="nav-text">直方图连接</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="zhujian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">zhujian</p><div class="site-description" itemprop="description">one bite at a time</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">169</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">48</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">129</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="feed-link motion-element"><a href="/./atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zjZSTU" title="Github &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;zjZSTU" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/u012005313" title="CSDN &amp;rarr; https:&#x2F;&#x2F;blog.csdn.net&#x2F;u012005313" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> CSDN</a></span><span class="links-of-author-item"><a href="/mailto:zjzstu@gmail.com" title="Gmail &amp;rarr; mailto:zjzstu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> Gmail</a></span><span class="links-of-author-item"><a href="/mailto:505169307@gmail.com" title="QQmail &amp;rarr; mailto:505169307@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> QQmail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://cloud.tencent.com/" title="https:&#x2F;&#x2F;cloud.tencent.com" rel="noopener" target="_blank">腾讯云</a></li><li class="links-of-blogroll-item"> <a href="https://www.aliyun.com/" title="https:&#x2F;&#x2F;www.aliyun.com" rel="noopener" target="_blank">阿里云</a></li><li class="links-of-blogroll-item"> <a href="https://developer.android.com/" title="https:&#x2F;&#x2F;developer.android.com&#x2F;" rel="noopener" target="_blank">Android Dev</a></li><li class="links-of-blogroll-item"> <a href="https://jenkins.io/" title="https:&#x2F;&#x2F;jenkins.io&#x2F;" rel="noopener" target="_blank">Jenkins</a></li><li class="links-of-blogroll-item"> <a href="http://cs231n.github.io/" title="http:&#x2F;&#x2F;cs231n.github.io&#x2F;" rel="noopener" target="_blank">cs231n</a></li><li class="links-of-blogroll-item"> <a href="https://pytorch.org/docs/stable/index.html" title="https:&#x2F;&#x2F;pytorch.org&#x2F;docs&#x2F;stable&#x2F;index.html" rel="noopener" target="_blank">pytorch</a></li><li class="links-of-blogroll-item"> <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" title="https:&#x2F;&#x2F;docs.docker.com&#x2F;install&#x2F;linux&#x2F;docker-ce&#x2F;ubuntu&#x2F;" rel="noopener" target="_blank">docker</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">zhujian</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">948k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">26:20</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-bar-chart-o"></i></span> <a href="https://tongji.baidu.com/web/27249108/overview/index?siteId=13647183" rel="noopener" target="_blank">百度统计</a></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0</div><div class="beian"> <a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备 19026415号</a> <span class="post-meta-divider">|</span> <img src="/images/beian_icon.png" style="display:inline-block;text-decoration:none;height:13px"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011802001748" rel="noopener" target="_blank">浙公网安备 33011802001748号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span> <span class="site-uv" title="总访客量">访客数：<span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="site-pv" title="总访问量">阅读量：<span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="17,63,61" opacity="1" zindex="-1" count="199" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '8f22595c6dd29c94467d',
      clientSecret: 'e66bd90ebb9aa66c562c753dec6c90ceecbd51f2',
      repo: 'guestbook',
      owner: 'zjZSTU',
      admin: ['zjZSTU'],
      id: '33097f74b47a46286460d793e14e6442',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script></body></html>