<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="alternate" href="/./atom.xml" title="做一个幸福的人" type="application/atom+xml"><meta name="google-site-verification" content="Qr_3yqLtyErDFKHW7mE8PJz4qDUX-bf_fMLpSRckQe4"><meta name="baidu-site-verification" content="zOwIvKMV7f"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.5.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"搜索文章",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap" rel="stylesheet"><meta name="description" content="参考：Precision and recall混淆矩阵PR曲线是另一种衡量算法性能的评价标准，其使用精确度（Precision）和召回率（Recall）作为坐标系的基底"><meta name="keywords" content="python,sklearn,AP,精确率,召回率"><meta property="og:type" content="article"><meta property="og:title" content="[二分类]PR曲线"><meta property="og:url" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;posts&#x2F;bca792b4.html"><meta property="og:site_name" content="做一个幸福的人"><meta property="og:description" content="参考：Precision and recall混淆矩阵PR曲线是另一种衡量算法性能的评价标准，其使用精确度（Precision）和召回率（Recall）作为坐标系的基底"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;pr-lr&#x2F;pr-logistic-regression.png"><meta property="og:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;pr-lr&#x2F;pr-logistic-regression-2.png"><meta property="og:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;pr-lr&#x2F;pr-compare.png"><meta property="og:updated_time" content="2020-02-15T05:36:35.871Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;imgs&#x2F;pr-lr&#x2F;pr-logistic-regression.png"><link rel="canonical" href="https://www.zhujian.tech/posts/bca792b4.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>[二分类]PR曲线 | 做一个幸福的人</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e677aac1ac69b8826b9cfecb4e72e107";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">做一个幸福的人</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">面朝大海，春暖花开</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签<span class="badge">129</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类<span class="badge">48</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档<span class="badge">169</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header> <a href="https://github.com/zjZSTU" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zhujian.tech/posts/bca792b4.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="zhujian"><meta itemprop="description" content="one bite at a time"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="做一个幸福的人"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> [二分类]PR曲线</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-12-27 13:52:21" itemprop="dateCreated datePublished" datetime="2019-12-27T13:52:21+00:00">2019-12-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-02-15 05:36:35" itemprop="dateModified" datetime="2020-02-15T05:36:35+00:00">2020-02-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/programming-language/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/criterion/" itemprop="url" rel="index"><span itemprop="name">评价标准</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/codebase/" itemprop="url" rel="index"><span itemprop="name">代码库</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/criterion/precision-recall-curve/" itemprop="url" rel="index"><span itemprop="name">PR曲线</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>4.5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>7 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>参考：</p><p><a href="https://en.wikipedia.org/wiki/Precision_and_recall" target="_blank" rel="noopener">Precision and recall</a></p><p><a href="https://zhujian.tech/posts/74ea027a.html" target="_blank" rel="noopener">混淆矩阵</a></p><p><code>PR</code>曲线是另一种衡量算法性能的评价标准，其使用精确度（<code>Precision</code>）和召回率（<code>Recall</code>）作为坐标系的基底</p><a id="more"></a><p><strong><em>本文着重于二分类的PR曲线</em></strong></p><h2 id="精确度"><a href="#精确度" class="headerlink" title="精确度"></a>精确度</h2><p>参考：<a href="https://en.wikipedia.org/wiki/Positive_and_negative_predictive_values" target="_blank" rel="noopener">Positive and negative predictive values</a></p><p>精确度（<code>Precision</code>）也称为正预测值（<code>positive predictive value, PPV</code>），表示预测正确的正样本占整个实际正样本集的比率</p><script type="math/tex;mode=display">
PPV = \frac {TP}{TP + FP}</script><h2 id="召回率"><a href="#召回率" class="headerlink" title="召回率"></a>召回率</h2><p>参考：<a href="https://en.wikipedia.org/wiki/Sensitivity_and_specificity" target="_blank" rel="noopener">Sensitivity and specificity</a></p><p>召回率（<code>Recall</code>）也称为敏感度（<code>sensitivity</code>）、真阳性率（<code>true positive rate, TPR</code>），表示预测正确的正样本占整个预测正样本集的比率</p><script type="math/tex;mode=display">
TPR = \frac {TP}{TP + FN}</script><h2 id="PR曲线"><a href="#PR曲线" class="headerlink" title="PR曲线"></a>PR曲线</h2><p><code>PPV</code>和<code>TPR</code>两者都是对于预测正样本集的理解和衡量</p><ul><li>高精度意味着算法预测结果能够更好的覆盖所有的正样本（也就是<strong>查准率</strong>），但也可能存在更多的假阴性样本</li><li>高召回率意味着算法预测结果中包含了更多的正样本（也就是<strong>查全率</strong>），但也可能导致正样本占实际正样本的比率不高（存在更多的假阳性样本）</li></ul><p><code>PR</code>曲线是一个图，其<code>y</code>轴表示精度，<code>x</code>轴表示召回率，通过在不同阈值条件下计算<code>(Recall, Precision)</code>数据对，绘制得到<code>PR</code>曲线</p><p>根据定义可知，最好的预测结果发生在右上角<code>(1,1)</code>，此时所有预测为真的样本均为实际正样本，没有正样本被预测为假</p><h2 id="如何通过PR判断分类器性能-AP"><a href="#如何通过PR判断分类器性能-AP" class="headerlink" title="如何通过PR判断分类器性能 - AP"></a>如何通过PR判断分类器性能 - AP</h2><p>和<code>ROC</code>曲线类似，需要计算曲线下面积来评判分类器性能，称之为平均精度（<code>AP, average precision</code>）</p><script type="math/tex;mode=display">
AP = \sum_{n}(R_{n} - R_{n-1})P_{n}</script><p>点$(R_{n}, P_{n})$表示第$n$个阈值下的精度和召回率</p><h2 id="Python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h2><p><code>Python</code>库<code>Sklearn</code>提供了<code>PR</code>曲线的计算函数：</p><ul><li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.average_precision_score.html#sklearn.metrics.average_precision_score" target="_blank" rel="noopener">sklearn.metrics.average_precision_score</a></li><li><a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.precision_recall_curve.html#sklearn.metrics.precision_recall_curve" target="_blank" rel="noopener">sklearn.metrics.precision_recall_curve</a></li></ul><h3 id="average-precision-score"><a href="#average-precision-score" class="headerlink" title="average_precision_score"></a>average_precision_score</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def average_precision_score(y_true, y_score, average=&quot;macro&quot;, pos_label=1,</span><br><span class="line">                            sample_weight=None):</span><br></pre></td></tr></table></figure><p>用于计算预测成绩的平均精度</p><ul><li><code>y_true</code>：数组形式，二值标签</li><li><code>y_score</code>：目标样本的成绩</li><li><code>pos_label</code>：正样本标签，默认为<code>1</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">from sklearn.metrics import average_precision_score</span><br><span class="line"></span><br><span class="line">y_true = np.array([0, 0, 1, 1])</span><br><span class="line">y_scores = np.array([0.1, 0.4, 0.35, 0.8])</span><br><span class="line">average_precision_score(y_true, y_scores)</span><br></pre></td></tr></table></figure><h3 id="precision-recall-curve"><a href="#precision-recall-curve" class="headerlink" title="precision_recall_curve"></a>precision_recall_curve</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def precision_recall_curve(y_true, probas_pred, pos_label=None,</span><br><span class="line">                           sample_weight=None):</span><br></pre></td></tr></table></figure><p>计算不同概率阈值下的精确率和召回率</p><ul><li><code>y_true</code>：数组形式，表示样本标签，如果不是<code>{-1,1}</code>或者<code>{0,1}</code>形式，那么属性<code>pos_label</code>应该指定</li><li><code>probas_pred</code>：预测置信度</li><li><code>pos_label</code>：正样本类，默认为<code>1</code></li></ul><p>返回<code>3</code>个数组，分别是精确率数组、召回率数组和阈值数组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">from sklearn.metrics import precision_recall_curve</span><br><span class="line"></span><br><span class="line">y_true = np.array([0, 0, 1, 1])</span><br><span class="line">y_scores = np.array([0.1, 0.4, 0.35, 0.8])</span><br><span class="line">precision, recall, thresholds = precision_recall_curve(y_true, y_scores)</span><br></pre></td></tr></table></figure><h3 id="计算最佳阈值"><a href="#计算最佳阈值" class="headerlink" title="计算最佳阈值"></a>计算最佳阈值</h3><p>综合来看，就是最接近坐标<code>(1,1)</code>的点所对应的阈值就是最佳阈值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">best_th = threshold[np.argmax(precision + recall)]</span><br></pre></td></tr></table></figure><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>参考<a href="https://zhujian.tech/posts/71a847e.html" target="_blank" rel="noopener">[二分类]ROC曲线</a>使用<code>Fashion-MNIST</code>数据集，分两种情况</p><ol><li><code>6000</code>个运动鞋+<code>6000</code>个短靴作为训练集</li><li><code>1000</code>个运动鞋+<code>6000</code>个短靴作为训练集</li></ol><h3 id="测试１"><a href="#测试１" class="headerlink" title="测试１"></a>测试１</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: zj</span><br><span class="line">@file:   2-pr.py</span><br><span class="line">@time:   2020-01-10</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">from mnist_reader import load_mnist</span><br><span class="line">from lr_classifier import LogisticClassifier</span><br><span class="line">import numpy as np</span><br><span class="line">from sklearn.metrics import precision_recall_curve</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_two_cate(ratio=1.0):</span><br><span class="line">    path = &quot;/home/zj/data/fashion-mnist/fashion-mnist/data/fashion/&quot;</span><br><span class="line">    train_images, train_labels = load_mnist(path, kind=&apos;train&apos;)</span><br><span class="line">    test_images, test_labels = load_mnist(path, kind=&apos;t10k&apos;)</span><br><span class="line"></span><br><span class="line">    num_train_seven = np.sum(train_labels == 7)</span><br><span class="line">    num_train_nine = np.sum(train_labels == 9)</span><br><span class="line">    # print(num_train_seven, num_train_nine)</span><br><span class="line"></span><br><span class="line">    num_test_seven = np.sum(test_labels == 7)</span><br><span class="line">    num_test_nine = np.sum(test_labels == 9)</span><br><span class="line">    # print(num_test_seven, num_test_nine)</span><br><span class="line"></span><br><span class="line">    x_train_0 = train_images[(train_labels == 7)]</span><br><span class="line">    x_train_1 = train_images[(train_labels == 9)]</span><br><span class="line">    y_train_0 = train_labels[(train_labels == 7)]</span><br><span class="line">    y_train_1 = train_labels[(train_labels == 9)]</span><br><span class="line"></span><br><span class="line">    x_train = np.vstack((x_train_0[:int(ratio * num_train_seven)], x_train_1))</span><br><span class="line">    y_train = np.concatenate((y_train_0[:int(ratio * num_train_seven)], y_train_1))</span><br><span class="line">    x_test = test_images[(test_labels == 7) + (test_labels == 9)]</span><br><span class="line">    y_test = test_labels[(test_labels == 7) + (test_labels == 9)]</span><br><span class="line"></span><br><span class="line">    return x_train, (y_train == 9) + 0, x_test, (y_test == 9) + 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def compute_accuracy(y, y_pred):</span><br><span class="line">    num = y.shape[0]</span><br><span class="line">    num_correct = np.sum(y_pred == y)</span><br><span class="line">    acc = float(num_correct) / num</span><br><span class="line">    return acc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    train_images, train_labels, test_images, test_labels = get_two_cate()</span><br><span class="line"></span><br><span class="line">    print(train_images.shape)</span><br><span class="line">    print(test_images.shape)</span><br><span class="line"></span><br><span class="line">    # cv2.imshow(&apos;img&apos;, train_images[100].reshape(28, -1))</span><br><span class="line">    # cv2.waitKey(0)</span><br><span class="line"></span><br><span class="line">    x_train = train_images.astype(np.float64)</span><br><span class="line">    x_test = test_images.astype(np.float64)</span><br><span class="line">    mu = np.mean(x_train, axis=0)</span><br><span class="line">    var = np.var(x_train, axis=0)</span><br><span class="line">    eps = 1e-8</span><br><span class="line">    x_train = (x_train - mu) / np.sqrt(np.maximum(var, eps))</span><br><span class="line">    x_test = (x_test - mu) / np.sqrt(np.maximum(var, eps))</span><br><span class="line"></span><br><span class="line">    classifier = LogisticClassifier()</span><br><span class="line">    classifier.train(x_train, train_labels)</span><br><span class="line">    res_labels, scores = classifier.predict(x_test)</span><br><span class="line"></span><br><span class="line">    acc = compute_accuracy(test_labels, res_labels)</span><br><span class="line">    print(acc)</span><br><span class="line"></span><br><span class="line">    precision, recall, threshold = precision_recall_curve(test_labels, scores, pos_label=1)</span><br><span class="line">    fig = plt.figure()</span><br><span class="line">    plt.plot(precision, recall, label=&apos;PR&apos;)</span><br><span class="line">    plt.legend()</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">    best_th = threshold[np.argmax(precision + recall)]</span><br><span class="line">    print(best_th)</span><br><span class="line">    y_pred = scores &gt; best_th + 0</span><br><span class="line">    acc = compute_accuracy(test_labels, y_pred)</span><br><span class="line">    print(acc)</span><br></pre></td></tr></table></figure><p>训练结果如下：</p><p><img src="/imgs/pr-lr/pr-logistic-regression.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(12000, 784)</span><br><span class="line">(2000, 784)</span><br><span class="line">0.9205                                                 # 阈值为0.5</span><br><span class="line">0.45903893031121357</span><br><span class="line">0.9285                                                 # 阈值为0.4590</span><br></pre></td></tr></table></figure><p>通过寻找最佳阈值，使得最后的准确率增加了<code>0.8%</code></p><h3 id="测试2"><a href="#测试2" class="headerlink" title="测试2"></a>测试2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_images, train_labels, test_images, test_labels = get_two_cate(ratio=1.0 / 6)</span><br></pre></td></tr></table></figure><p>训练结果如下：</p><p><img src="/imgs/pr-lr/pr-logistic-regression-2.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(7000, 784)</span><br><span class="line">(2000, 784)</span><br><span class="line">0.871                                               # 阈值为0.5</span><br><span class="line">0.33526167648147953</span><br><span class="line">0.9215                                            # 阈值为0.3353</span><br></pre></td></tr></table></figure><p>从结果可知，<code>PR</code>曲线同样能够在类别数目不平衡的情况下有效的评估分类器性能</p><p><img src="/imgs/pr-lr/pr-compare.png" alt></p></div><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/wechatpay.jpg" alt="zhujian 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/images/alipay.jpg" alt="zhujian 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> zhujian</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.zhujian.tech/posts/bca792b4.html" title="[二分类]PR曲线">https://www.zhujian.tech/posts/bca792b4.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/python/" rel="tag"># python</a> <a href="/tags/sklearn/" rel="tag"># sklearn</a> <a href="/tags/AP/" rel="tag"># AP</a> <a href="/tags/precision/" rel="tag"># 精确率</a> <a href="/tags/recall-rate/" rel="tag"># 召回率</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/bd2847bc.html" rel="next" title="知识金字塔"><i class="fa fa-chevron-left"></i> 知识金字塔</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/1431c640.html" rel="prev" title="[Jenkins][GitLab]docker-compose实现">[Jenkins][GitLab]docker-compose实现<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#精确度"><span class="nav-number">1.</span> <span class="nav-text">精确度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#召回率"><span class="nav-number">2.</span> <span class="nav-text">召回率</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PR曲线"><span class="nav-number">3.</span> <span class="nav-text">PR曲线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何通过PR判断分类器性能-AP"><span class="nav-number">4.</span> <span class="nav-text">如何通过PR判断分类器性能 - AP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python实现"><span class="nav-number">5.</span> <span class="nav-text">Python实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#average-precision-score"><span class="nav-number">5.1.</span> <span class="nav-text">average_precision_score</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#precision-recall-curve"><span class="nav-number">5.2.</span> <span class="nav-text">precision_recall_curve</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#计算最佳阈值"><span class="nav-number">5.3.</span> <span class="nav-text">计算最佳阈值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#示例"><span class="nav-number">6.</span> <span class="nav-text">示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#测试１"><span class="nav-number">6.1.</span> <span class="nav-text">测试１</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试2"><span class="nav-number">6.2.</span> <span class="nav-text">测试2</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="zhujian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">zhujian</p><div class="site-description" itemprop="description">one bite at a time</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">169</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">48</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">129</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="feed-link motion-element"><a href="/./atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zjZSTU" title="Github &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;zjZSTU" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/u012005313" title="CSDN &amp;rarr; https:&#x2F;&#x2F;blog.csdn.net&#x2F;u012005313" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> CSDN</a></span><span class="links-of-author-item"><a href="/mailto:zjzstu@gmail.com" title="Gmail &amp;rarr; mailto:zjzstu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> Gmail</a></span><span class="links-of-author-item"><a href="/mailto:505169307@gmail.com" title="QQmail &amp;rarr; mailto:505169307@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> QQmail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://cloud.tencent.com/" title="https:&#x2F;&#x2F;cloud.tencent.com" rel="noopener" target="_blank">腾讯云</a></li><li class="links-of-blogroll-item"> <a href="https://www.aliyun.com/" title="https:&#x2F;&#x2F;www.aliyun.com" rel="noopener" target="_blank">阿里云</a></li><li class="links-of-blogroll-item"> <a href="https://developer.android.com/" title="https:&#x2F;&#x2F;developer.android.com&#x2F;" rel="noopener" target="_blank">Android Dev</a></li><li class="links-of-blogroll-item"> <a href="https://jenkins.io/" title="https:&#x2F;&#x2F;jenkins.io&#x2F;" rel="noopener" target="_blank">Jenkins</a></li><li class="links-of-blogroll-item"> <a href="http://cs231n.github.io/" title="http:&#x2F;&#x2F;cs231n.github.io&#x2F;" rel="noopener" target="_blank">cs231n</a></li><li class="links-of-blogroll-item"> <a href="https://pytorch.org/docs/stable/index.html" title="https:&#x2F;&#x2F;pytorch.org&#x2F;docs&#x2F;stable&#x2F;index.html" rel="noopener" target="_blank">pytorch</a></li><li class="links-of-blogroll-item"> <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" title="https:&#x2F;&#x2F;docs.docker.com&#x2F;install&#x2F;linux&#x2F;docker-ce&#x2F;ubuntu&#x2F;" rel="noopener" target="_blank">docker</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">zhujian</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">948k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">26:20</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-bar-chart-o"></i></span> <a href="https://tongji.baidu.com/web/27249108/overview/index?siteId=13647183" rel="noopener" target="_blank">百度统计</a></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0</div><div class="beian"> <a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备 19026415号</a> <span class="post-meta-divider">|</span> <img src="/images/beian_icon.png" style="display:inline-block;text-decoration:none;height:13px"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011802001748" rel="noopener" target="_blank">浙公网安备 33011802001748号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span> <span class="site-uv" title="总访客量">访客数：<span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="site-pv" title="总访问量">阅读量：<span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="17,63,61" opacity="1" zindex="-1" count="199" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '8f22595c6dd29c94467d',
      clientSecret: 'e66bd90ebb9aa66c562c753dec6c90ceecbd51f2',
      repo: 'guestbook',
      owner: 'zjZSTU',
      admin: ['zjZSTU'],
      id: '7fb603903493bed84e31a6f28c17a2e4',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script></body></html>