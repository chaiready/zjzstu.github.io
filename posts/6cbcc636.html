<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="alternate" href="/./atom.xml" title="做一个幸福的人" type="application/atom+xml"><meta name="google-site-verification" content="Qr_3yqLtyErDFKHW7mE8PJz4qDUX-bf_fMLpSRckQe4"><meta name="baidu-site-verification" content="zOwIvKMV7f"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.5.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"搜索文章",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap" rel="stylesheet"><meta name="description" content="最近进行图像处理时遇到PPM文件，其格式与PGM文件类似，参考Python pgm解析和格式转换进行PPM文件格式解析以及图像格式转换"><meta name="keywords" content="python,opencv,numpy,ppm,argparse"><meta property="og:type" content="article"><meta property="og:title" content="PPM文件解析"><meta property="og:url" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;posts&#x2F;6cbcc636.html"><meta property="og:site_name" content="做一个幸福的人"><meta property="og:description" content="最近进行图像处理时遇到PPM文件，其格式与PGM文件类似，参考Python pgm解析和格式转换进行PPM文件格式解析以及图像格式转换"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2020-02-15T05:36:35.871Z"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.zhujian.tech/posts/6cbcc636.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>PPM文件解析 | 做一个幸福的人</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e677aac1ac69b8826b9cfecb4e72e107";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">做一个幸福的人</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">面朝大海，春暖花开</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签<span class="badge">129</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类<span class="badge">48</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档<span class="badge">169</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header> <a href="https://github.com/zjZSTU" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zhujian.tech/posts/6cbcc636.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="zhujian"><meta itemprop="description" content="one bite at a time"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="做一个幸福的人"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> PPM文件解析</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-10 13:53:08" itemprop="dateCreated datePublished" datetime="2019-08-10T13:53:08+00:00">2019-08-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-02-15 05:36:35" itemprop="dateModified" datetime="2020-02-15T05:36:35+00:00">2020-02-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/programming-language/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/data/" itemprop="url" rel="index"><span itemprop="name">数据</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/codebase/" itemprop="url" rel="index"><span itemprop="name">代码库</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/data/data-format/" itemprop="url" rel="index"><span itemprop="name">数据格式</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>6.3k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>11 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>最近进行图像处理时遇到<a href="http://netpbm.sourceforge.net/doc/ppm.html" target="_blank" rel="noopener">PPM</a>文件，其格式与<code>PGM</code>文件类似，参考<a href="https://blog.csdn.net/u012005313/article/details/83685584" target="_blank" rel="noopener">Python pgm解析和格式转换</a>进行<code>PPM</code>文件格式解析以及图像格式转换</p><a id="more"></a><h2 id="PPM"><a href="#PPM" class="headerlink" title="PPM"></a>PPM</h2><p><code>PPM</code>(<code>Portable Pixel Map</code>，便携式像素地图)文件是<code>Netpbm</code>开源工程设计的一种图像格式，除了<code>ppm</code>外，还有<code>pbm，pgm</code>。<code>PPM</code>文件由一个或多个<code>PPM</code>图像序列组成。在图像之前、之后或之间没有数据、分隔符或填充</p><p>每个<code>PPM</code>文件按序包含如下信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1. A &quot;magic number&quot; for identifying the file type. A ppm image&apos;s magic number is the two characters &quot;P6&quot;.</span><br><span class="line">2. Whitespace (blanks, TABs, CRs, LFs).</span><br><span class="line">3. A width, formatted as ASCII characters in decimal.</span><br><span class="line">4. Whitespace.</span><br><span class="line">5. A height, again in ASCII decimal.</span><br><span class="line">6. Whitespace.</span><br><span class="line">7. The maximum color value (Maxval), again in ASCII decimal. Must be less than 65536 and more than zero.</span><br><span class="line">8. A single whitespace character (usually a newline).</span><br><span class="line">9. A raster of Height rows, in order from top to bottom. Each row consists of Width pixels, in order from left to right. Each pixel is a triplet of red, green, and blue samples, in that order. Each sample is represented in pure binary by either 1 or 2 bytes. If the Maxval is less than 256, it is 1 byte. Otherwise, it is 2 bytes. The most significant byte is first.</span><br><span class="line"></span><br><span class="line">1. 用于识别文件类型的“幻数”。PPM图像的幻数是两个字符“P6”。</span><br><span class="line">2. 空格（blanks, TABs, CRs, LFs）。</span><br><span class="line">3. 宽度，格式为ASCII十进制数字。</span><br><span class="line">4. 空格。</span><br><span class="line">5. 高度，同样为ASCII十进制数字。</span><br><span class="line">6. 空格。</span><br><span class="line">7. 最大灰度值（Maxval），同时是ASCII十进制。范围为[0，6536]。</span><br><span class="line">8. 单个空白字符（通常是换行符）。</span><br><span class="line">9. 按从上到下的顺序排列的高度行光栅。每行由宽度大小像素组成，从左到右依次排列。每一个像素都是红、绿、蓝三色样本的三重组合。每个样本用纯二进制表示，用1或2个字节表示。如果maxval小于256，则为1字节。否则，它是2个字节。最重要的字节是第一个。</span><br></pre></td></tr></table></figure><p><em>注意 1：以<code>#</code>开头的字符串可能是注释，与<a href="http://netpbm.sourceforge.net/doc/pbm.html" target="_blank" rel="noopener">PBM</a>相同</em></p><p><em>注意 2：图像数据集是连续存放的</em></p><p>使用<code>vim</code>打开<code>PPM</code>文件，初始文件信息如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">P6</span><br><span class="line">1440 1080</span><br><span class="line">255</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="Plain-PPM"><a href="#Plain-PPM" class="headerlink" title="Plain PPM"></a>Plain PPM</h3><p>还存在另一种格式的<code>PPM</code>文件，其差别如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. There is exactly one image in a file.</span><br><span class="line">2. The magic number is P3 instead of P6.</span><br><span class="line">3. Each sample in the raster is represented as an ASCII decimal number (of arbitrary size).</span><br><span class="line">4. Each sample in the raster has white space before and after it. There must be at least one character of white space between any two samples, but there is no maximum. There is no particular separation of one pixel from another -- just the required separation between the blue sample of one pixel from the red sample of the next pixel.</span><br><span class="line">5. No line should be longer than 70 characters.</span><br><span class="line"></span><br><span class="line">1. 文件中仅有单个图像。</span><br><span class="line">2. 幻数是P3。</span><br><span class="line">3. 栅格中的每个像素表示为ASCII十进制数（任意大小）。</span><br><span class="line">4. 光栅中的每个样本前后都有空白。任何两个样本之间必须至少有一个空白字符，没有最多空白限制。一个像素与另一个像素之间没有特殊的分离——只是一个像素的蓝色样本与下一个像素的红色样本之间需要的分离。</span><br><span class="line">5. 没有一行应该长于70个字符。</span><br></pre></td></tr></table></figure><p>样本图像如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">P3</span><br><span class="line"># feep.ppm</span><br><span class="line">4 4</span><br><span class="line">15</span><br><span class="line"> 0  0  0    0  0  0    0  0  0   15  0 15</span><br><span class="line"> 0  0  0    0 15  7    0  0  0    0  0  0</span><br><span class="line"> 0  0  0    0  0  0    0 15  7    0  0  0</span><br><span class="line">15  0 15    0  0  0    0  0  0    0  0  0</span><br></pre></td></tr></table></figure><p><em>注意：每行末尾都有一个换行符</em></p><h3 id="文件命名"><a href="#文件命名" class="headerlink" title="文件命名"></a>文件命名</h3><p>通常以<code>.PPM</code>或者<code>.ppm</code>文件结尾</p><h3 id="PPM-vs-PGM"><a href="#PPM-vs-PGM" class="headerlink" title="PPM vs. PGM"></a>PPM vs. PGM</h3><p><code>PPM</code>文件是<code>3</code>通道彩色图像文件，<code>PGM</code>是灰度图像文件</p><h2 id="格式转换"><a href="#格式转换" class="headerlink" title="格式转换"></a>格式转换</h2><p>可以使用库<code>Image</code>进行<code>PPM</code>格式与<code>PNG/JPEG</code>等其他格式转换</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">img = Image.open(&apos;test.PPM&apos;)</span><br><span class="line">img.save(&apos;test2.png&apos;)</span><br><span class="line">img.show()</span><br></pre></td></tr></table></figure><p>也可依据图像格式读取文件信息后在转换成图像，完整代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line"># @Time    : 19-8-10 下午2:21</span><br><span class="line"># @Author  : zj</span><br><span class="line"></span><br><span class="line">from __future__ import print_function</span><br><span class="line"></span><br><span class="line">import cv2</span><br><span class="line">import time</span><br><span class="line">import os</span><br><span class="line">import operator</span><br><span class="line">import numpy as np</span><br><span class="line">import argparse</span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">__author__ = &apos;zj&apos;</span><br><span class="line"></span><br><span class="line">image_formats = [&apos;jpg&apos;, &apos;JPG&apos;, &apos;jpeg&apos;, &apos;JPEG&apos;, &apos;png&apos;, &apos;PNG&apos;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def is_ppm_file(in_path):</span><br><span class="line">    if not os.path.isfile(in_path):</span><br><span class="line">        return False</span><br><span class="line">    if in_path is not str and not in_path.lower().endswith(&apos;.ppm&apos;):</span><br><span class="line">        return False</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def convert_ppm_by_PIL(in_path, out_path):</span><br><span class="line">    if not is_ppm_file(in_path):</span><br><span class="line">        raise Exception(&quot;%s 不是一个PPM文件&quot; % in_path)</span><br><span class="line">    # 读取文件</span><br><span class="line">    im = Image.open(in_path)</span><br><span class="line">    im.save(out_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def convert_ppm_P6(in_path, out_path):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    将ppm文件转换成其它图像格式</span><br><span class="line">    读取二进制文件，先读取幻数，再读取宽和高，以及最大值</span><br><span class="line">    :param in_path: 输入ppm文件路径</span><br><span class="line">    :param out_path: 输出文件路径</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if not is_ppm_file(in_path):</span><br><span class="line">        raise Exception(&quot;%s 不是一个PPM文件&quot; % in_path)</span><br><span class="line">    with open(in_path, &apos;rb&apos;) as f:</span><br><span class="line">        # 读取两个字节 - 幻数，并解码成字符串</span><br><span class="line">        magic_number = f.readline().strip().decode(&apos;utf-8&apos;)</span><br><span class="line">        if not operator.eq(magic_number, &quot;P6&quot;):</span><br><span class="line">            raise Exception(&quot;该图像有误&quot;)</span><br><span class="line">        # 读取高和宽</span><br><span class="line">        width, height = f.readline().strip().decode(&apos;utf-8&apos;).split(&apos; &apos;)</span><br><span class="line">        width = int(width)</span><br><span class="line">        height = int(height)</span><br><span class="line">        # 读取最大值</span><br><span class="line">        maxval = f.readline().strip()</span><br><span class="line">        byte_array = np.array(list(f.readline()))</span><br><span class="line">        img = byte_array.reshape((height, width, 3)).astype(np.uint8)</span><br><span class="line">        img = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)</span><br><span class="line">        cv2.imwrite(out_path, img)</span><br><span class="line">        print(&apos;%s save ok&apos; % out_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def convert_ppm_P6_batch(in_dir, out_dir, res_format):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    批量转换PPM文件</span><br><span class="line">    :param in_dir: ppm文件夹路径</span><br><span class="line">    :param out_dir: 输出文件夹路径</span><br><span class="line">    :param res_format: 结果图像格式</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if not os.path.isdir(in_dir):</span><br><span class="line">        raise Exception(&apos;%s 不是路径&apos; % in_dir)</span><br><span class="line">    if not os.path.isdir(out_dir):</span><br><span class="line">        raise Exception(&apos;%s 不是路径&apos; % out_dir)</span><br><span class="line">    if not res_format in image_formats:</span><br><span class="line">        raise Exception(&apos;%s 暂不支持&apos; % res_format)</span><br><span class="line">    file_list = os.listdir(in_dir)</span><br><span class="line">    for file_name in file_list:</span><br><span class="line">        file_path = os.path.join(in_dir, file_name)</span><br><span class="line">        # 若为ppm文件路径，那么将其进行格式转换</span><br><span class="line">        if is_ppm_file(file_path):</span><br><span class="line">            file_out_path = os.path.join(out_dir, os.path.splitext(file_name)[0] + &apos;.&apos; + res_format)</span><br><span class="line">            convert_ppm_P6(file_path, file_out_path)</span><br><span class="line">        # 若为目录，则新建结果文件目录，递归处理</span><br><span class="line">        elif os.path.isdir(file_path):</span><br><span class="line">            file_out_dir = os.path.join(out_dir, file_name)</span><br><span class="line">            if not os.path.exists(file_out_dir):</span><br><span class="line">                os.mkdir(file_out_dir)</span><br><span class="line">            convert_ppm_P6_batch(file_path, file_out_dir, res_format)</span><br><span class="line">        else:</span><br><span class="line">            pass</span><br><span class="line">    print(&apos;batch operation over&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    script_start_time = time.time()</span><br><span class="line"></span><br><span class="line">    parser = argparse.ArgumentParser(description=&apos;Format Converter - PPM&apos;)</span><br><span class="line"></span><br><span class="line">    ### Positional arguments</span><br><span class="line"></span><br><span class="line">    ### Optional arguments</span><br><span class="line"></span><br><span class="line">    parser.add_argument(&apos;-i&apos;, &apos;--input&apos;, type=str, help=&apos;Path to the ppm file&apos;)</span><br><span class="line">    parser.add_argument(&apos;-o&apos;, &apos;--output&apos;, type=str, help=&apos;Path to the result file&apos;)</span><br><span class="line">    parser.add_argument(&apos;--input_dir&apos;, type=str, help=&apos;Dir to the ppm files&apos;)</span><br><span class="line">    parser.add_argument(&apos;--output_dir&apos;, type=str, help=&apos;Dir to the result files&apos;)</span><br><span class="line">    parser.add_argument(&apos;-f&apos;, &apos;--format&apos;, default=&apos;png&apos;, type=str, help=&apos;result image format&apos;)</span><br><span class="line">    parser.add_argument(&apos;-b&apos;, &apos;--batch&apos;, action=&quot;store_true&quot;, default=False, help=&apos;Batch processing&apos;)</span><br><span class="line"></span><br><span class="line">    args = vars(parser.parse_args())</span><br><span class="line">    # print(args)</span><br><span class="line">    in_path = args[&apos;input&apos;]</span><br><span class="line">    out_path = args[&apos;output&apos;]</span><br><span class="line"></span><br><span class="line">    isbatch = args[&apos;batch&apos;]</span><br><span class="line">    in_dir = args[&apos;input_dir&apos;]</span><br><span class="line">    out_dir = args[&apos;output_dir&apos;]</span><br><span class="line">    res_format = args[&apos;format&apos;]</span><br><span class="line"></span><br><span class="line">    if in_path is not None and out_path is not None:</span><br><span class="line">        # 转换单个ppm文件格式</span><br><span class="line">        convert_ppm_P6(in_path, out_path)</span><br><span class="line">        # convert_ppm_by_PIL(in_path, out_path)</span><br><span class="line">    elif isbatch:</span><br><span class="line">        # 批量转换</span><br><span class="line">        convert_ppm_P6_batch(in_dir, out_dir, res_format)</span><br><span class="line">    else:</span><br><span class="line">        print(&apos;请输入相应参数&apos;)</span><br><span class="line"></span><br><span class="line">    print(&apos;Script took %s seconds.&apos; % (time.time() - script_start_time,))</span><br></pre></td></tr></table></figure><p>转换单个<code>PPM</code>图像为<code>PNG</code>图像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python ppm_converter.py -i test.ppm -o test2.png</span><br><span class="line">test2.png save ok</span><br><span class="line">Script took 0.2900853157043457 seconds.</span><br></pre></td></tr></table></figure><p>批量转换<code>PPM</code>图像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python ppm_converter.py --input_dir 输入路径 --output_dir 输出路径 -f PNG -b</span><br></pre></td></tr></table></figure></div><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/wechatpay.jpg" alt="zhujian 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/images/alipay.jpg" alt="zhujian 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> zhujian</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.zhujian.tech/posts/6cbcc636.html" title="PPM文件解析">https://www.zhujian.tech/posts/6cbcc636.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/python/" rel="tag"># python</a> <a href="/tags/opencv/" rel="tag"># opencv</a> <a href="/tags/numpy/" rel="tag"># numpy</a> <a href="/tags/ppm/" rel="tag"># ppm</a> <a href="/tags/argparse/" rel="tag"># argparse</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/2e594804.html" rel="next" title="基于图的图像分割-引言"><i class="fa fa-chevron-left"></i> 基于图的图像分割-引言</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/44a20d07.html" rel="prev" title="[译]高效的基于图的图像分割">[译]高效的基于图的图像分割<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#PPM"><span class="nav-number">1.</span> <span class="nav-text">PPM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Plain-PPM"><span class="nav-number">1.1.</span> <span class="nav-text">Plain PPM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件命名"><span class="nav-number">1.2.</span> <span class="nav-text">文件命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PPM-vs-PGM"><span class="nav-number">1.3.</span> <span class="nav-text">PPM vs. PGM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#格式转换"><span class="nav-number">2.</span> <span class="nav-text">格式转换</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="zhujian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">zhujian</p><div class="site-description" itemprop="description">one bite at a time</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">169</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">48</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">129</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="feed-link motion-element"><a href="/./atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zjZSTU" title="Github &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;zjZSTU" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/u012005313" title="CSDN &amp;rarr; https:&#x2F;&#x2F;blog.csdn.net&#x2F;u012005313" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> CSDN</a></span><span class="links-of-author-item"><a href="/mailto:zjzstu@gmail.com" title="Gmail &amp;rarr; mailto:zjzstu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> Gmail</a></span><span class="links-of-author-item"><a href="/mailto:505169307@gmail.com" title="QQmail &amp;rarr; mailto:505169307@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> QQmail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://cloud.tencent.com/" title="https:&#x2F;&#x2F;cloud.tencent.com" rel="noopener" target="_blank">腾讯云</a></li><li class="links-of-blogroll-item"> <a href="https://www.aliyun.com/" title="https:&#x2F;&#x2F;www.aliyun.com" rel="noopener" target="_blank">阿里云</a></li><li class="links-of-blogroll-item"> <a href="https://developer.android.com/" title="https:&#x2F;&#x2F;developer.android.com&#x2F;" rel="noopener" target="_blank">Android Dev</a></li><li class="links-of-blogroll-item"> <a href="https://jenkins.io/" title="https:&#x2F;&#x2F;jenkins.io&#x2F;" rel="noopener" target="_blank">Jenkins</a></li><li class="links-of-blogroll-item"> <a href="http://cs231n.github.io/" title="http:&#x2F;&#x2F;cs231n.github.io&#x2F;" rel="noopener" target="_blank">cs231n</a></li><li class="links-of-blogroll-item"> <a href="https://pytorch.org/docs/stable/index.html" title="https:&#x2F;&#x2F;pytorch.org&#x2F;docs&#x2F;stable&#x2F;index.html" rel="noopener" target="_blank">pytorch</a></li><li class="links-of-blogroll-item"> <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" title="https:&#x2F;&#x2F;docs.docker.com&#x2F;install&#x2F;linux&#x2F;docker-ce&#x2F;ubuntu&#x2F;" rel="noopener" target="_blank">docker</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">zhujian</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">948k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">26:20</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-bar-chart-o"></i></span> <a href="https://tongji.baidu.com/web/27249108/overview/index?siteId=13647183" rel="noopener" target="_blank">百度统计</a></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0</div><div class="beian"> <a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备 19026415号</a> <span class="post-meta-divider">|</span> <img src="/images/beian_icon.png" style="display:inline-block;text-decoration:none;height:13px"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011802001748" rel="noopener" target="_blank">浙公网安备 33011802001748号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span> <span class="site-uv" title="总访客量">访客数：<span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="site-pv" title="总访问量">阅读量：<span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="17,63,61" opacity="1" zindex="-1" count="199" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '8f22595c6dd29c94467d',
      clientSecret: 'e66bd90ebb9aa66c562c753dec6c90ceecbd51f2',
      repo: 'guestbook',
      owner: 'zjZSTU',
      admin: ['zjZSTU'],
      id: '1680cc67022e261c939ea20a3d3c1a18',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script></body></html>