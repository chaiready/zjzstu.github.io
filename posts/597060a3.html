<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="alternate" href="/./atom.xml" title="做一个幸福的人" type="application/atom+xml"><meta name="google-site-verification" content="Qr_3yqLtyErDFKHW7mE8PJz4qDUX-bf_fMLpSRckQe4"><meta name="baidu-site-verification" content="zOwIvKMV7f"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.5.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"搜索文章",hits_empty:"我们没有找到任何搜索结果: ${query}",hits_stats:"找到约${hits}条结果（用时${time}ms）"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap" rel="stylesheet"><meta name="description" content="参考：在 Caffe 中如何计算卷积？卷积神经网络推导-批量图片矩阵计算im2col表示image to column，将图像转换成列向量"><meta name="keywords" content="python,numpy"><meta property="og:type" content="article"><meta property="og:title" content="im2col解析2"><meta property="og:url" content="https:&#x2F;&#x2F;www.zhujian.tech&#x2F;posts&#x2F;597060a3.html"><meta property="og:site_name" content="做一个幸福的人"><meta property="og:description" content="参考：在 Caffe 中如何计算卷积？卷积神经网络推导-批量图片矩阵计算im2col表示image to column，将图像转换成列向量"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2020-02-15T05:36:35.871Z"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.zhujian.tech/posts/597060a3.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>im2col解析2 | 做一个幸福的人</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e677aac1ac69b8826b9cfecb4e72e107";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">做一个幸福的人</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">面朝大海，春暖花开</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签<span class="badge">129</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类<span class="badge">48</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档<span class="badge">169</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header> <a href="https://github.com/zjZSTU" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zhujian.tech/posts/597060a3.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="zhujian"><meta itemprop="description" content="one bite at a time"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="做一个幸福的人"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> im2col解析2</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-05-25 12:39:38" itemprop="dateCreated datePublished" datetime="2019-05-25T12:39:38+00:00">2019-05-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-02-15 05:36:35" itemprop="dateModified" datetime="2020-02-15T05:36:35+00:00">2020-02-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">算法</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/deep-learning/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/programming-language/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/deep-learning/convolutional-neural-network/" itemprop="url" rel="index"><span itemprop="name">卷积神经网络</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/codebase/" itemprop="url" rel="index"><span itemprop="name">代码库</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>13k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>21 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>参考：</p><p><a href="https://www.zhihu.com/question/28385679" target="_blank" rel="noopener">在 Caffe 中如何计算卷积？</a></p><p><a href="https://www.zhujian.tech/posts/ab1e719c.html#more">卷积神经网络推导-批量图片矩阵计算</a></p><p><code>im2col</code>表示<code>image to column</code>，将图像转换成列向量</p><a id="more"></a><p><strong>卷积操作步骤</strong>：首先将卷积核映射到<code>x_padded</code>左上角，然后沿着行方向操作，每次滑动<code>stride</code>距离；到达最右端后，将卷积核往列方向滑动<code>stride</code>距离，再实现从左到右的滑动</p><h2 id="图像转列向量"><a href="#图像转列向量" class="headerlink" title="图像转列向量"></a>图像转列向量</h2><p>在以下操作中，假设感受野大小为<code>field_height = field_width = 2</code>，零填充<code>padding = 0</code>，步长<code>stride = 2</code></p><h3 id="2维图像"><a href="#2维图像" class="headerlink" title="2维图像"></a>2维图像</h3><p><strong>以(3,3)大小矩阵为例</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = np.arange(9).reshape(3,3)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[0, 1, 2],</span><br><span class="line">       [3, 4, 5],</span><br><span class="line">       [6, 7, 8]])</span><br></pre></td></tr></table></figure><p>那么得到的局部连接数为</p><script type="math/tex;mode=display">
(3 - 2 + 2*0)/1 + 1 = 2\\
num = 2*2 = 4</script><p>所以共有4个局部连接，分别是</p><script type="math/tex;mode=display">
\begin{bmatrix}
0 & 1\\ 
3 & 4
\end{bmatrix}\ \ 
\begin{bmatrix}
1 & 2\\ 
4 & 5
\end{bmatrix}\ \  
\begin{bmatrix}
3 & 4\\ 
6 & 7
\end{bmatrix}
\begin{bmatrix}
4 & 5\\ 
7 & 8
\end{bmatrix}</script><p>其坐标分别为</p><script type="math/tex;mode=display">
\begin{bmatrix}
(0,0) & (0,1)\\ 
(1,0) & (1,1)
\end{bmatrix}\ \ 
\begin{bmatrix}
(0,1) & (0,2)\\
(1,1) & (1,2)
\end{bmatrix}\ \  
\begin{bmatrix}
(1,0) & (1,1)\\
(2,0) & (2,1)
\end{bmatrix}
\begin{bmatrix}
(1,1) & (1,2)\\
(2,1) & (2,2)
\end{bmatrix}</script><p>将其列向量化，可得</p><script type="math/tex;mode=display">
matrix=
\begin{bmatrix}
0 & 1 & 3 & 4\\ 
1 & 2 & 4 & 5\\ 
3 & 4 & 6 & 7\\ 
4 & 5 & 7 & 8
\end{bmatrix}</script><script type="math/tex;mode=display">
indexs=
\begin{bmatrix}
(0,0) & (0,1) & (1,0) & (1,1)\\ 
(0,1) & (0,2) & (1,1) & (1,2)\\ 
(1,0) & (1,1) & (2,0) & (2,1)\\ 
(1,1) & (1,2) & (2,1) & (2,2)
\end{bmatrix}</script><p>进行行列坐标分离</p><script type="math/tex;mode=display">
rows_{index}=
\begin{bmatrix}
0 & 0 & 1 & 1\\ 
0 & 0 & 1 & 1\\ 
1 & 1 & 2 & 2\\ 
1 & 1 & 2 & 2
\end{bmatrix}</script><script type="math/tex;mode=display">
columns_{index}=
\begin{bmatrix}
0 & 1 & 0 & 1\\ 
1 & 2 & 1 & 2\\ 
0 & 1 & 0 & 1\\ 
1 & 2 & 1 & 2
\end{bmatrix}</script><p>对卷积核而言，每行的行坐标一致，共有<code>field_width</code>个，每个卷积核有<code>field_height</code>行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># i0 = np.repeat(np.arange(field_height), field_width)</span><br><span class="line">&gt;&gt;&gt; i0 = np.repeat(np.arange(2), 2)</span><br><span class="line">&gt;&gt;&gt; i0</span><br><span class="line">array([0, 0, 1, 1])</span><br></pre></td></tr></table></figure><p>每行共有<code>out_width</code>个局部连接矩阵，每个矩阵相隔<code>stride</code>，共有<code>out_height</code>行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># i1 = stride * np.repeat(np.arange(out_height), out_width)</span><br><span class="line">&gt;&gt;&gt; i1 = 1 * np.repeat(np.arange(2), 2)</span><br><span class="line">&gt;&gt;&gt; i1</span><br><span class="line">array([0, 0, 1, 1])</span><br></pre></td></tr></table></figure><p>对于局部连接矩阵的行坐标为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># i = i0.reshape(-1, 1) + i1.reshape(1, -1)</span><br><span class="line">&gt;&gt;&gt; i0.reshape(-1,1)</span><br><span class="line">array([[0],</span><br><span class="line">       [0],</span><br><span class="line">       [1],</span><br><span class="line">       [1]])</span><br><span class="line">&gt;&gt;&gt; i1.reshape(1,-1)</span><br><span class="line">array([[0, 0, 1, 1]])</span><br><span class="line">&gt;&gt;&gt; i = i0.reshape(-1,1)+i1.reshape(1,-1)</span><br><span class="line">&gt;&gt;&gt; i</span><br><span class="line">array([[0, 0, 1, 1],</span><br><span class="line">       [0, 0, 1, 1],</span><br><span class="line">       [1, 1, 2, 2],</span><br><span class="line">       [1, 1, 2, 2]])</span><br></pre></td></tr></table></figure><p>同样的，对于卷积核的列来说，其相邻列相差<code>1</code>，长<code>field_width</code>，共有<code>field_height</code>行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># j0 = np.tile(np.arange(field_width), field_height * C)</span><br><span class="line">&gt;&gt;&gt; j0 = np.tile(np.arange(2),2)</span><br><span class="line">&gt;&gt;&gt; j0</span><br><span class="line">array([0, 1, 0, 1])</span><br></pre></td></tr></table></figure><p>每行有<code>out_width</code>个局部连接矩阵，矩阵之间相差<code>stride</code>步长，同一列矩阵相对于该行最左侧的距离相同</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># j1 = stride * np.tile(np.arange(out_width), out_height)</span><br><span class="line">&gt;&gt;&gt; j1 = 1*np.tile(np.arange(2), 2)</span><br><span class="line">&gt;&gt;&gt; j1</span><br><span class="line">array([0, 1, 0, 1])</span><br></pre></td></tr></table></figure><p>计算局部连接矩阵的行坐标</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># j = j0.reshape(-1, 1) + j1.reshape(1, -1)</span><br><span class="line">&gt;&gt;&gt; j0.reshape(-1,1)</span><br><span class="line">array([[0],</span><br><span class="line">       [1],</span><br><span class="line">       [0],</span><br><span class="line">       [1]])</span><br><span class="line">&gt;&gt;&gt; j1.reshape(1,-1)</span><br><span class="line">array([[0, 1, 0, 1]])</span><br><span class="line">&gt;&gt;&gt; j = j0.reshape(-1,1) + j1.reshape(1,-1)</span><br><span class="line">&gt;&gt;&gt; j</span><br><span class="line">array([[0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2],</span><br><span class="line">       [0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2]])</span><br></pre></td></tr></table></figure><p>得到列向量矩阵的行坐标和列坐标后，求取局部连接矩阵的列向量矩阵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a[i,j]</span><br><span class="line">array([[0, 1, 3, 4],</span><br><span class="line">       [1, 2, 4, 5],</span><br><span class="line">       [3, 4, 6, 7],</span><br><span class="line">       [4, 5, 7, 8]])</span><br></pre></td></tr></table></figure><h3 id="3维图像"><a href="#3维图像" class="headerlink" title="3维图像"></a>3维图像</h3><p>如果图像有多通道，每个通道图像的卷积操作一致，局部连接总数不变，仅扩展每个卷积矩阵的大小，所以仅需在行/列坐标矩阵的列方向扩展即可</p><p>比如有$2\times 3\times 3$大小图像，通道数为<code>2</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = np.arange(18).reshape(2,3,3)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[[ 0,  1,  2],</span><br><span class="line">        [ 3,  4,  5],</span><br><span class="line">        [ 6,  7,  8]],</span><br><span class="line"></span><br><span class="line">       [[ 9, 10, 11],</span><br><span class="line">        [12, 13, 14],</span><br><span class="line">        [15, 16, 17]]])</span><br></pre></td></tr></table></figure><p>局部连接矩阵大小为$2\times 2\times 2$，比如</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">array([[[ 0,  1],</span><br><span class="line">        [ 3,  4],</span><br><span class="line"></span><br><span class="line">       [[ 9, 10],</span><br><span class="line">        [12, 13]]])</span><br></pre></td></tr></table></figure><p>对于行坐标矩阵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; i0 = np.repeat(np.arange(2), 2)</span><br><span class="line">&gt;&gt;&gt; i0</span><br><span class="line">array([0, 0, 1, 1])</span><br><span class="line">&gt;&gt;&gt; i0 = np.tile(i0, 2)</span><br><span class="line">&gt;&gt;&gt; i0</span><br><span class="line">array([0, 0, 1, 1, 0, 0, 1, 1])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; i1 = 1 * np.repeat(np.arange(2), 2)</span><br><span class="line">&gt;&gt;&gt; i1</span><br><span class="line">array([0, 0, 1, 1])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; i = i0.reshape(-1,1) + i1.reshape(1, -1)</span><br><span class="line">&gt;&gt;&gt; i</span><br><span class="line">array([[0, 0, 1, 1],</span><br><span class="line">       [0, 0, 1, 1],</span><br><span class="line">       [1, 1, 2, 2],</span><br><span class="line">       [1, 1, 2, 2],</span><br><span class="line">       [0, 0, 1, 1],</span><br><span class="line">       [0, 0, 1, 1],</span><br><span class="line">       [1, 1, 2, 2],</span><br><span class="line">       [1, 1, 2, 2]])</span><br></pre></td></tr></table></figure><p>对于列坐标矩阵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; j0 = np.tile(np.arange(2), 2*2)</span><br><span class="line">&gt;&gt;&gt; j0</span><br><span class="line">array([0, 1, 0, 1, 0, 1, 0, 1])</span><br><span class="line">&gt;&gt;&gt; j1 = 1 * np.tile(np.arange(2), 2)</span><br><span class="line">&gt;&gt;&gt; j1</span><br><span class="line">array([0, 1, 0, 1])</span><br><span class="line">&gt;&gt;&gt; j = j0.reshape(-1, 1) + j1.reshape(1, -1)</span><br><span class="line">&gt;&gt;&gt; j</span><br><span class="line">array([[0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2],</span><br><span class="line">       [0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2],</span><br><span class="line">       [0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2],</span><br><span class="line">       [0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2]])</span><br></pre></td></tr></table></figure><p><strong>还需要计算通道向量k，用于指定哪个通道图像</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; k = np.repeat(np.arange(2), 2*2).reshape(-1,1)</span><br><span class="line">&gt;&gt;&gt; k</span><br><span class="line">array([[0],</span><br><span class="line">       [0],</span><br><span class="line">       [0],</span><br><span class="line">       [0],</span><br><span class="line">       [1],</span><br><span class="line">       [1],</span><br><span class="line">       [1],</span><br><span class="line">       [1]])</span><br></pre></td></tr></table></figure><p>最后求取局部连接矩阵的列向量矩阵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a[k,i,j]</span><br><span class="line">array([[ 0,  1,  3,  4],</span><br><span class="line">       [ 1,  2,  4,  5],</span><br><span class="line">       [ 3,  4,  6,  7],</span><br><span class="line">       [ 4,  5,  7,  8],</span><br><span class="line">       [ 9, 10, 12, 13],</span><br><span class="line">       [10, 11, 13, 14],</span><br><span class="line">       [12, 13, 15, 16],</span><br><span class="line">       [13, 14, 16, 17]])</span><br></pre></td></tr></table></figure><h3 id="4维图像"><a href="#4维图像" class="headerlink" title="4维图像"></a>4维图像</h3><p>批量处理多通道图像，比如批量图像数据大小为$2\times 2\times 3\times 3$，共<code>2</code>张图片，每张图像<code>2</code>通道，大小为$3\times 3$</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = np.arange(36).reshape(2,2,3,3)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[[[ 0,  1,  2],</span><br><span class="line">         [ 3,  4,  5],</span><br><span class="line">         [ 6,  7,  8]],</span><br><span class="line"></span><br><span class="line">        [[ 9, 10, 11],</span><br><span class="line">         [12, 13, 14],</span><br><span class="line">         [15, 16, 17]]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       [[[18, 19, 20],</span><br><span class="line">         [21, 22, 23],</span><br><span class="line">         [24, 25, 26]],</span><br><span class="line"></span><br><span class="line">        [[27, 28, 29],</span><br><span class="line">         [30, 31, 32],</span><br><span class="line">         [33, 34, 35]]]])</span><br></pre></td></tr></table></figure><p>对于行/列坐标矩阵<code>i,j</code>以及通道向量<code>k</code>与<code>3</code>维图像操作一致</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a[:,k,i,j]</span><br><span class="line">array([[[ 0,  1,  3,  4],</span><br><span class="line">        [ 1,  2,  4,  5],</span><br><span class="line">        [ 3,  4,  6,  7],</span><br><span class="line">        [ 4,  5,  7,  8],</span><br><span class="line">        [ 9, 10, 12, 13],</span><br><span class="line">        [10, 11, 13, 14],</span><br><span class="line">        [12, 13, 15, 16],</span><br><span class="line">        [13, 14, 16, 17]],</span><br><span class="line"></span><br><span class="line">       [[18, 19, 21, 22],</span><br><span class="line">        [19, 20, 22, 23],</span><br><span class="line">        [21, 22, 24, 25],</span><br><span class="line">        [22, 23, 25, 26],</span><br><span class="line">        [27, 28, 30, 31],</span><br><span class="line">        [28, 29, 31, 32],</span><br><span class="line">        [30, 31, 33, 34],</span><br><span class="line">        [31, 32, 34, 35]]])</span><br><span class="line">&gt;&gt;&gt; a[:,k,i,j].shape</span><br><span class="line">(2, 8, 4)</span><br></pre></td></tr></table></figure><p>得到的是一个<code>3</code>维数据体，第一维表示图像数，第二维表示单个矩阵向量，第三维表示每个图片的局部矩阵数</p><p>先进行维数转换，再变形为2维矩阵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = np.transpose(b, (1,2,0))</span><br><span class="line">&gt;&gt;&gt; c.shape</span><br><span class="line">(8, 4, 2)</span><br><span class="line">&gt;&gt;&gt; c.reshape(8, -1)</span><br><span class="line">array([[ 0, 18,  1, 19,  3, 21,  4, 22],</span><br><span class="line">       [ 1, 19,  2, 20,  4, 22,  5, 23],</span><br><span class="line">       [ 3, 21,  4, 22,  6, 24,  7, 25],</span><br><span class="line">       [ 4, 22,  5, 23,  7, 25,  8, 26],</span><br><span class="line">       [ 9, 27, 10, 28, 12, 30, 13, 31],</span><br><span class="line">       [10, 28, 11, 29, 13, 31, 14, 32],</span><br><span class="line">       [12, 30, 13, 31, 15, 33, 16, 34],</span><br><span class="line">       [13, 31, 14, 32, 16, 34, 17, 35]])</span><br></pre></td></tr></table></figure><p>最后得到了<code>2</code>维矩阵，每列表示一个局部连接矩阵向量，其排列方式为依次加入每个图像的相同位置局部连接矩阵，再向左向下滑动（<strong><code>im2col.py</code>实现方式</strong>）</p><p><strong>如果想要先完成单个图像所有局部连接矩阵，再进行下一个图像的转换，可以修改维数变换如下</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = np.transpose(b, (1,0,2))</span><br><span class="line">&gt;&gt;&gt; c.shape</span><br><span class="line">(8, 2, 4)</span><br><span class="line">&gt;&gt;&gt; c.reshape(8, -1)</span><br><span class="line">array([[ 0,  1,  3,  4, 18, 19, 21, 22],</span><br><span class="line">       [ 1,  2,  4,  5, 19, 20, 22, 23],</span><br><span class="line">       [ 3,  4,  6,  7, 21, 22, 24, 25],</span><br><span class="line">       [ 4,  5,  7,  8, 22, 23, 25, 26],</span><br><span class="line">       [ 9, 10, 12, 13, 27, 28, 30, 31],</span><br><span class="line">       [10, 11, 13, 14, 28, 29, 31, 32],</span><br><span class="line">       [12, 13, 15, 16, 30, 31, 33, 34],</span><br><span class="line">       [13, 14, 16, 17, 31, 32, 34, 35]])</span><br></pre></td></tr></table></figure><h2 id="列向量转图像"><a href="#列向量转图像" class="headerlink" title="列向量转图像"></a>列向量转图像</h2><p>将图像转列向量小节中得到的列向量矩阵重新映射回图像</p><h3 id="2维图像-1"><a href="#2维图像-1" class="headerlink" title="2维图像"></a>2维图像</h3><p>已知图像大小为$3\times 3$，卷积核大小为$2\times 2$，步长为<code>2</code>，零填充为<code>0</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = np.arange(9).reshape(3,3)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[0, 1, 2],</span><br><span class="line">       [3, 4, 5],</span><br><span class="line">       [6, 7, 8]])</span><br><span class="line"># 列向量矩阵</span><br><span class="line">&gt;&gt;&gt; a[i,j]</span><br><span class="line">array([[0, 1, 3, 4],</span><br><span class="line">       [1, 2, 4, 5],</span><br><span class="line">       [3, 4, 6, 7],</span><br><span class="line">       [4, 5, 7, 8]])</span><br></pre></td></tr></table></figure><p>根据图像数据和参数获取行/列坐标矩阵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; i</span><br><span class="line">array([[0, 0, 1, 1],</span><br><span class="line">       [0, 0, 1, 1],</span><br><span class="line">       [1, 1, 2, 2],</span><br><span class="line">       [1, 1, 2, 2]])</span><br><span class="line">&gt;&gt;&gt; j</span><br><span class="line">array([[0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2],</span><br><span class="line">       [0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2]])</span><br></pre></td></tr></table></figure><p>获取<code>2</code>维列矩阵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; cols = a[i,j]</span><br><span class="line">&gt;&gt;&gt; cols</span><br><span class="line">array([[0, 1, 3, 4],</span><br><span class="line">       [1, 2, 4, 5],</span><br><span class="line">       [3, 4, 6, 7],</span><br><span class="line">       [4, 5, 7, 8]])</span><br></pre></td></tr></table></figure><p>将<code>2</code>维列矩阵映射到图像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; b = np.zeros(a.shape)</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[0., 0., 0.],</span><br><span class="line">       [0., 0., 0.],</span><br><span class="line">       [0., 0., 0.]])</span><br><span class="line">&gt;&gt;&gt; np.add.at(b, (i,j), cols)</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[ 0.,  2.,  2.],</span><br><span class="line">       [ 6., 16., 10.],</span><br><span class="line">       [ 6., 14.,  8.]])</span><br></pre></td></tr></table></figure><p><strong>反向映射得到的图像数据和原先图像数据不一致，因为卷积操作中许多下标的位置被多次采集</strong></p><p>如果想要得到原图，<strong>需要除以叠加的倍数</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = np.zeros(a.shape)</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">array([[0., 0., 0.],</span><br><span class="line">       [0., 0., 0.],</span><br><span class="line">       [0., 0., 0.]])</span><br><span class="line">&gt;&gt;&gt; c = np.ones(a.shape)</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">array([[1., 1., 1.],</span><br><span class="line">       [1., 1., 1.],</span><br><span class="line">       [1., 1., 1.]])</span><br><span class="line">&gt;&gt;&gt; cols_c = c[i,j]</span><br><span class="line">&gt;&gt;&gt; cols_c</span><br><span class="line">array([[1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.]])</span><br><span class="line">&gt;&gt;&gt; d = np.zeros(c.shape)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">array([[0., 0., 0.],</span><br><span class="line">       [0., 0., 0.],</span><br><span class="line">       [0., 0., 0.]])</span><br><span class="line">&gt;&gt;&gt; np.add.at(d, (i,j), cols_c)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">array([[1., 2., 1.],</span><br><span class="line">       [2., 4., 2.],</span><br><span class="line">       [1., 2., 1.]])</span><br><span class="line">&gt;&gt;&gt; b/d</span><br><span class="line">array([[0., 1., 2.],</span><br><span class="line">       [3., 4., 5.],</span><br><span class="line">       [6., 7., 8.]])</span><br><span class="line">&gt;&gt;&gt; b/d == a</span><br><span class="line">array([[ True,  True,  True],</span><br><span class="line">       [ True,  True,  True],</span><br><span class="line">       [ True,  True,  True]])</span><br></pre></td></tr></table></figure><h3 id="3维图像-1"><a href="#3维图像-1" class="headerlink" title="3维图像"></a>3维图像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a = np.arange(18).reshape(2,3,3)</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">array([[[ 0,  1,  2],</span><br><span class="line">        [ 3,  4,  5],</span><br><span class="line">        [ 6,  7,  8]],</span><br><span class="line"></span><br><span class="line">       [[ 9, 10, 11],</span><br><span class="line">        [12, 13, 14],</span><br><span class="line">        [15, 16, 17]]])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; i</span><br><span class="line">array([[0, 0, 1, 1],</span><br><span class="line">       [0, 0, 1, 1],</span><br><span class="line">       [1, 1, 2, 2],</span><br><span class="line">       [1, 1, 2, 2],</span><br><span class="line">       [0, 0, 1, 1],</span><br><span class="line">       [0, 0, 1, 1],</span><br><span class="line">       [1, 1, 2, 2],</span><br><span class="line">       [1, 1, 2, 2]])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; j</span><br><span class="line">array([[0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2],</span><br><span class="line">       [0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2],</span><br><span class="line">       [0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2],</span><br><span class="line">       [0, 1, 0, 1],</span><br><span class="line">       [1, 2, 1, 2]])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; k</span><br><span class="line">array([[0],</span><br><span class="line">       [0],</span><br><span class="line">       [0],</span><br><span class="line">       [0],</span><br><span class="line">       [1],</span><br><span class="line">       [1],</span><br><span class="line">       [1],</span><br><span class="line">       [1]])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; cols = a[k,i,j]</span><br><span class="line">&gt;&gt;&gt; cols</span><br><span class="line">array([[ 0,  1,  3,  4],</span><br><span class="line">       [ 1,  2,  4,  5],</span><br><span class="line">       [ 3,  4,  6,  7],</span><br><span class="line">       [ 4,  5,  7,  8],</span><br><span class="line">       [ 9, 10, 12, 13],</span><br><span class="line">       [10, 11, 13, 14],</span><br><span class="line">       [12, 13, 15, 16],</span><br><span class="line">       [13, 14, 16, 17]])</span><br></pre></td></tr></table></figure><p>反向计算图像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; np.add.at(b, (k, i, j), cols)</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[[ 0.,  2.,  2.],</span><br><span class="line">        [ 6., 16., 10.],</span><br><span class="line">        [ 6., 14.,  8.]],</span><br><span class="line"></span><br><span class="line">       [[ 9., 20., 11.],</span><br><span class="line">        [24., 52., 28.],</span><br><span class="line">        [15., 32., 17.]]])</span><br></pre></td></tr></table></figure><p>除以叠加倍数，转变回原图</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = np.ones(a.shape)</span><br><span class="line">&gt;&gt;&gt; cols_c = c[k,i,j]</span><br><span class="line">&gt;&gt;&gt; cols_c</span><br><span class="line">array([[1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.],</span><br><span class="line">       [1., 1., 1., 1.]])</span><br><span class="line">&gt;&gt;&gt; d = np.zeros(c.shape)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">array([[[0., 0., 0.],</span><br><span class="line">        [0., 0., 0.],</span><br><span class="line">        [0., 0., 0.]],</span><br><span class="line"></span><br><span class="line">       [[0., 0., 0.],</span><br><span class="line">        [0., 0., 0.],</span><br><span class="line">        [0., 0., 0.]]])</span><br><span class="line">&gt;&gt;&gt; np.add.at(d, (k,i,j), cols_c)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">array([[[1., 2., 1.],</span><br><span class="line">        [2., 4., 2.],</span><br><span class="line">        [1., 2., 1.]],</span><br><span class="line"></span><br><span class="line">       [[1., 2., 1.],</span><br><span class="line">        [2., 4., 2.],</span><br><span class="line">        [1., 2., 1.]]])</span><br><span class="line">&gt;&gt;&gt; b/d</span><br><span class="line">array([[[ 0.,  1.,  2.],</span><br><span class="line">        [ 3.,  4.,  5.],</span><br><span class="line">        [ 6.,  7.,  8.]],</span><br><span class="line"></span><br><span class="line">       [[ 9., 10., 11.],</span><br><span class="line">        [12., 13., 14.],</span><br><span class="line">        [15., 16., 17.]]])</span><br><span class="line">&gt;&gt;&gt; b/d == a</span><br><span class="line">array([[[ True,  True,  True],</span><br><span class="line">        [ True,  True,  True],</span><br><span class="line">        [ True,  True,  True]],</span><br><span class="line"></span><br><span class="line">       [[ True,  True,  True],</span><br><span class="line">        [ True,  True,  True],</span><br><span class="line">        [ True,  True,  True]]])</span><br></pre></td></tr></table></figure><h3 id="4维图像-1"><a href="#4维图像-1" class="headerlink" title="4维图像"></a>4维图像</h3><p><strong>最终要实现的是批量图片列向量矩阵的反卷积操作</strong></p><p>从批量图像数据中通过坐标矩阵获取的列向量矩阵是<code>3</code>维大小，还需要通过维数转换和变形</p><p>列向量转图像需要执行反向操作，首先进行数据变形，再进行维数转换，最后通过坐标矩阵叠加</p><p>在上一小节中最后得到了两种排列的列向量矩阵，一种是<strong>先提取同一位置局部连接矩阵</strong>，另一种是<strong>先提取同一图片局部连接矩阵</strong></p><p>如果前向操作如下（第二种）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; cols = np.transpose(b, (1,2,0))</span><br><span class="line">&gt;&gt;&gt; cols.shape</span><br><span class="line">(8, 4, 2)</span><br><span class="line">&gt;&gt;&gt; cols.reshape(8, -1)</span><br><span class="line">array([[ 0,  1,  3,  4, 18, 19, 21, 22],</span><br><span class="line">       [ 1,  2,  4,  5, 19, 20, 22, 23],</span><br><span class="line">       [ 3,  4,  6,  7, 21, 22, 24, 25],</span><br><span class="line">       [ 4,  5,  7,  8, 22, 23, 25, 26],</span><br><span class="line">       [ 9, 10, 12, 13, 27, 28, 30, 31],</span><br><span class="line">       [10, 11, 13, 14, 28, 29, 31, 32],</span><br><span class="line">       [12, 13, 15, 16, 30, 31, 33, 34],</span><br><span class="line">       [13, 14, 16, 17, 31, 32, 34, 35]])</span><br></pre></td></tr></table></figure><p>那么反向操作为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; N=2</span><br><span class="line">&gt;&gt;&gt; cols_reshaped = cols.reshape(cols.shape[0], N, -1)</span><br><span class="line">&gt;&gt;&gt; cols_reshaped.shape</span><br><span class="line">(8, 2, 4)</span><br><span class="line">&gt;&gt;&gt; np.transpose(cols_reshaped, (1,0,2))</span><br><span class="line">array([[[ 0,  1,  3,  4],</span><br><span class="line">        [ 1,  2,  4,  5],</span><br><span class="line">        [ 3,  4,  6,  7],</span><br><span class="line">        [ 4,  5,  7,  8],</span><br><span class="line">        [ 9, 10, 12, 13],</span><br><span class="line">        [10, 11, 13, 14],</span><br><span class="line">        [12, 13, 15, 16],</span><br><span class="line">        [13, 14, 16, 17]],</span><br><span class="line"></span><br><span class="line">       [[18, 19, 21, 22],</span><br><span class="line">        [19, 20, 22, 23],</span><br><span class="line">        [21, 22, 24, 25],</span><br><span class="line">        [22, 23, 25, 26],</span><br><span class="line">        [27, 28, 30, 31],</span><br><span class="line">        [28, 29, 31, 32],</span><br><span class="line">        [30, 31, 33, 34],</span><br><span class="line">        [31, 32, 34, 35]]])</span><br></pre></td></tr></table></figure><p>批量图片大小为$2\times 2\times 3\times 3$，得到最终的反向结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">b = np.zeros(a.shape)</span><br><span class="line">&gt;&gt;&gt; np.add.at(b, (slice(None), k, i,j), cols_reshaped)</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">array([[[[  0.,   2.,   2.],</span><br><span class="line">         [  6.,  16.,  10.],</span><br><span class="line">         [  6.,  14.,   8.]],</span><br><span class="line"></span><br><span class="line">        [[  9.,  20.,  11.],</span><br><span class="line">         [ 24.,  52.,  28.],</span><br><span class="line">         [ 15.,  32.,  17.]]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       [[[ 18.,  38.,  20.],</span><br><span class="line">         [ 42.,  88.,  46.],</span><br><span class="line">         [ 24.,  50.,  26.]],</span><br><span class="line"></span><br><span class="line">        [[ 27.,  56.,  29.],</span><br><span class="line">         [ 60., 124.,  64.],</span><br><span class="line">         [ 33.,  68.,  35.]]]])</span><br></pre></td></tr></table></figure><p>除以叠加倍数，得到最初的图像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; c = np.ones(a.shape)</span><br><span class="line">&gt;&gt;&gt; cols_c = c[:,k,i,j]</span><br><span class="line">&gt;&gt;&gt; cols_c</span><br><span class="line">array([[[1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.]],</span><br><span class="line"></span><br><span class="line">       [[1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.],</span><br><span class="line">        [1., 1., 1., 1.]]])</span><br><span class="line">&gt;&gt;&gt; d = np.zeros(c.shape)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">array([[[[0., 0., 0.],</span><br><span class="line">         [0., 0., 0.],</span><br><span class="line">         [0., 0., 0.]],</span><br><span class="line"></span><br><span class="line">        [[0., 0., 0.],</span><br><span class="line">         [0., 0., 0.],</span><br><span class="line">         [0., 0., 0.]]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       [[[0., 0., 0.],</span><br><span class="line">         [0., 0., 0.],</span><br><span class="line">         [0., 0., 0.]],</span><br><span class="line"></span><br><span class="line">        [[0., 0., 0.],</span><br><span class="line">         [0., 0., 0.],</span><br><span class="line">         [0., 0., 0.]]]])</span><br><span class="line">&gt;&gt;&gt; np.add.at(d, (slice(None), k,i,j), cols_c)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">array([[[[1., 2., 1.],</span><br><span class="line">         [2., 4., 2.],</span><br><span class="line">         [1., 2., 1.]],</span><br><span class="line"></span><br><span class="line">        [[1., 2., 1.],</span><br><span class="line">         [2., 4., 2.],</span><br><span class="line">         [1., 2., 1.]]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       [[[1., 2., 1.],</span><br><span class="line">         [2., 4., 2.],</span><br><span class="line">         [1., 2., 1.]],</span><br><span class="line"></span><br><span class="line">        [[1., 2., 1.],</span><br><span class="line">         [2., 4., 2.],</span><br><span class="line">         [1., 2., 1.]]]])</span><br><span class="line">&gt;&gt;&gt; b/d</span><br><span class="line">array([[[[ 0.,  1.,  2.],</span><br><span class="line">         [ 3.,  4.,  5.],</span><br><span class="line">         [ 6.,  7.,  8.]],</span><br><span class="line"></span><br><span class="line">        [[ 9., 10., 11.],</span><br><span class="line">         [12., 13., 14.],</span><br><span class="line">         [15., 16., 17.]]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       [[[18., 19., 20.],</span><br><span class="line">         [21., 22., 23.],</span><br><span class="line">         [24., 25., 26.]],</span><br><span class="line"></span><br><span class="line">        [[27., 28., 29.],</span><br><span class="line">         [30., 31., 32.],</span><br><span class="line">         [33., 34., 35.]]]])</span><br><span class="line">&gt;&gt;&gt; b/d == a</span><br><span class="line">array([[[[ True,  True,  True],</span><br><span class="line">         [ True,  True,  True],</span><br><span class="line">         [ True,  True,  True]],</span><br><span class="line"></span><br><span class="line">        [[ True,  True,  True],</span><br><span class="line">         [ True,  True,  True],</span><br><span class="line">         [ True,  True,  True]]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       [[[ True,  True,  True],</span><br><span class="line">         [ True,  True,  True],</span><br><span class="line">         [ True,  True,  True]],</span><br><span class="line"></span><br><span class="line">        [[ True,  True,  True],</span><br><span class="line">         [ True,  True,  True],</span><br><span class="line">         [ True,  True,  True]]]])</span><br></pre></td></tr></table></figure><h2 id="im2col-py"><a href="#im2col-py" class="headerlink" title="im2col.py"></a>im2col.py</h2><p><code>im2col.py</code>实现代码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">from builtins import range</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_im2col_indices(x_shape, field_height, field_width, padding=1, stride=1):</span><br><span class="line">    # First figure out what the size of the output should be</span><br><span class="line">    N, C, H, W = x_shape</span><br><span class="line">    assert (H + 2 * padding - field_height) % stride == 0</span><br><span class="line">    assert (W + 2 * padding - field_height) % stride == 0</span><br><span class="line">    out_height = (H + 2 * padding - field_height) / stride + 1</span><br><span class="line">    out_width = (W + 2 * padding - field_width) / stride + 1</span><br><span class="line"></span><br><span class="line">    i0 = np.repeat(np.arange(field_height), field_width)</span><br><span class="line">    i0 = np.tile(i0, C)</span><br><span class="line">    i1 = stride * np.repeat(np.arange(out_height), out_width)</span><br><span class="line">    j0 = np.tile(np.arange(field_width), field_height * C)</span><br><span class="line">    j1 = stride * np.tile(np.arange(out_width), out_height)</span><br><span class="line">    i = i0.reshape(-1, 1) + i1.reshape(1, -1)</span><br><span class="line">    j = j0.reshape(-1, 1) + j1.reshape(1, -1)</span><br><span class="line"></span><br><span class="line">    k = np.repeat(np.arange(C), field_height * field_width).reshape(-1, 1)</span><br><span class="line"></span><br><span class="line">    return (k, i, j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def im2col_indices(x, field_height, field_width, padding=1, stride=1):</span><br><span class="line">    &quot;&quot;&quot; An implementation of im2col based on some fancy indexing &quot;&quot;&quot;</span><br><span class="line">    # Zero-pad the input</span><br><span class="line">    p = padding</span><br><span class="line">    x_padded = np.pad(x, ((0, 0), (0, 0), (p, p), (p, p)), mode=&apos;constant&apos;)</span><br><span class="line"></span><br><span class="line">    k, i, j = get_im2col_indices(x.shape, field_height, field_width, padding,</span><br><span class="line">                                 stride)</span><br><span class="line"></span><br><span class="line">    cols = x_padded[:, k, i, j]</span><br><span class="line">    C = x.shape[1]</span><br><span class="line">    cols = cols.transpose(1, 2, 0).reshape(field_height * field_width * C, -1)</span><br><span class="line">    return cols</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def col2im_indices(cols, x_shape, field_height=3, field_width=3, padding=1,</span><br><span class="line">                   stride=1):</span><br><span class="line">    &quot;&quot;&quot; An implementation of col2im based on fancy indexing and np.add.at &quot;&quot;&quot;</span><br><span class="line">    N, C, H, W = x_shape</span><br><span class="line">    H_padded, W_padded = H + 2 * padding, W + 2 * padding</span><br><span class="line">    x_padded = np.zeros((N, C, H_padded, W_padded), dtype=cols.dtype)</span><br><span class="line">    k, i, j = get_im2col_indices(x_shape, field_height, field_width, padding,</span><br><span class="line">                                 stride)</span><br><span class="line">    cols_reshaped = cols.reshape(C * field_height * field_width, -1, N)</span><br><span class="line">    cols_reshaped = cols_reshaped.transpose(2, 0, 1)</span><br><span class="line">    np.add.at(x_padded, (slice(None), k, i, j), cols_reshaped)</span><br><span class="line">    if padding == 0:</span><br><span class="line">        return x_padded</span><br><span class="line">    return x_padded[:, :, padding:-padding, padding:-padding]</span><br></pre></td></tr></table></figure><p>包含两部分功能：图像转列向量以及列向量转图像</p><p>函数<code>get_im2col_indices</code>的功能是计算单个图像行/列坐标矩阵以及通道向量</p><p>函数<code>im2col_indices</code>的功能是实现图像转列向量</p><p>函数<code>col2im_indices</code>的功能是实现列向量转图像</p><p><strong>注意，<code>col2im_indices</code>得到的图像不等于原图，是叠加后的结果</strong></p></div><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/wechatpay.jpg" alt="zhujian 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/images/alipay.jpg" alt="zhujian 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> zhujian</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.zhujian.tech/posts/597060a3.html" title="im2col解析2">https://www.zhujian.tech/posts/597060a3.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/python/" rel="tag"># python</a> <a href="/tags/numpy/" rel="tag"># numpy</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/cc37c46b.html" rel="next" title="im2col解析1"><i class="fa fa-chevron-left"></i> im2col解析1</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/b77e018f.html" rel="prev" title="im2col解析3">im2col解析3<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#图像转列向量"><span class="nav-number">1.</span> <span class="nav-text">图像转列向量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2维图像"><span class="nav-number">1.1.</span> <span class="nav-text">2维图像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3维图像"><span class="nav-number">1.2.</span> <span class="nav-text">3维图像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4维图像"><span class="nav-number">1.3.</span> <span class="nav-text">4维图像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列向量转图像"><span class="nav-number">2.</span> <span class="nav-text">列向量转图像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2维图像-1"><span class="nav-number">2.1.</span> <span class="nav-text">2维图像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3维图像-1"><span class="nav-number">2.2.</span> <span class="nav-text">3维图像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4维图像-1"><span class="nav-number">2.3.</span> <span class="nav-text">4维图像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#im2col-py"><span class="nav-number">3.</span> <span class="nav-text">im2col.py</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="zhujian" src="/images/avatar.png"><p class="site-author-name" itemprop="name">zhujian</p><div class="site-description" itemprop="description">one bite at a time</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">169</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">48</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">129</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="feed-link motion-element"><a href="/./atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zjZSTU" title="Github &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;zjZSTU" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/u012005313" title="CSDN &amp;rarr; https:&#x2F;&#x2F;blog.csdn.net&#x2F;u012005313" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i> CSDN</a></span><span class="links-of-author-item"><a href="/mailto:zjzstu@gmail.com" title="Gmail &amp;rarr; mailto:zjzstu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> Gmail</a></span><span class="links-of-author-item"><a href="/mailto:505169307@gmail.com" title="QQmail &amp;rarr; mailto:505169307@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> QQmail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://cloud.tencent.com/" title="https:&#x2F;&#x2F;cloud.tencent.com" rel="noopener" target="_blank">腾讯云</a></li><li class="links-of-blogroll-item"> <a href="https://www.aliyun.com/" title="https:&#x2F;&#x2F;www.aliyun.com" rel="noopener" target="_blank">阿里云</a></li><li class="links-of-blogroll-item"> <a href="https://developer.android.com/" title="https:&#x2F;&#x2F;developer.android.com&#x2F;" rel="noopener" target="_blank">Android Dev</a></li><li class="links-of-blogroll-item"> <a href="https://jenkins.io/" title="https:&#x2F;&#x2F;jenkins.io&#x2F;" rel="noopener" target="_blank">Jenkins</a></li><li class="links-of-blogroll-item"> <a href="http://cs231n.github.io/" title="http:&#x2F;&#x2F;cs231n.github.io&#x2F;" rel="noopener" target="_blank">cs231n</a></li><li class="links-of-blogroll-item"> <a href="https://pytorch.org/docs/stable/index.html" title="https:&#x2F;&#x2F;pytorch.org&#x2F;docs&#x2F;stable&#x2F;index.html" rel="noopener" target="_blank">pytorch</a></li><li class="links-of-blogroll-item"> <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" title="https:&#x2F;&#x2F;docs.docker.com&#x2F;install&#x2F;linux&#x2F;docker-ce&#x2F;ubuntu&#x2F;" rel="noopener" target="_blank">docker</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">zhujian</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">948k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">26:20</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-bar-chart-o"></i></span> <a href="https://tongji.baidu.com/web/27249108/overview/index?siteId=13647183" rel="noopener" target="_blank">百度统计</a></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0</div><div class="beian"> <a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备 19026415号</a> <span class="post-meta-divider">|</span> <img src="/images/beian_icon.png" style="display:inline-block;text-decoration:none;height:13px"> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011802001748" rel="noopener" target="_blank">浙公网安备 33011802001748号</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span> <span class="site-uv" title="总访客量">访客数：<span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="site-pv" title="总访问量">阅读量：<span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="17,63,61" opacity="1" zindex="-1" count="199" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '8f22595c6dd29c94467d',
      clientSecret: 'e66bd90ebb9aa66c562c753dec6c90ceecbd51f2',
      repo: 'guestbook',
      owner: 'zjZSTU',
      admin: ['zjZSTU'],
      id: '7e5db4a9864f2816689e867b1f71b98d',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script></body></html>